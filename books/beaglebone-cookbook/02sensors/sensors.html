
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Sensors &#8212; BeagleBoard Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css?v=5c84f910" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=99f84846" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/design-tabs.js?v=36754332"></script>
    <script src="../../../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
    <script src="../../../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script src="../../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js?v=ffc8af2d"></script>
    <script src="../../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js?v=12818e64"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'books/beaglebone-cookbook/02sensors/sensors';</script>
    <link rel="canonical" href="docs.beagleboard.io/books/beaglebone-cookbook/02sensors/sensors.html" />
    <link rel="icon" href="../../../_static/boris.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Displays and Other Outputs" href="../03displays/displays.html" />
    <link rel="prev" title="Basics" href="../01basics/basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
    <meta name="docbuild:last-update" content="Jun 29, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  

    <!-- Top version and announcement message -->
    <script>
        
    // Function to generate version and announcement banner HTML
    function getBannerHTML() {
        return `
            
            <aside id="bd-header-version-warning" class="d-print-none" aria-label="Version warning">
                <div class="bd-header-announcement__content ms-auto me-auto">
                    <div class="sidebar-message">
                        
                        
                        This is an <strong>unknown version</strong> of docs.
                        
                        <a class="btn text-wrap font-weight-bold ms-3 my-1 align-baseline pst-button-link-to-stable-version" href="https://docs.beagleboard.org">
                            Switch to released version
                        </a>
                    </div>
                </div>
            </aside>
            
            
        `;
    }
    
    // Get the target element where the banners will be added
    const bannerDiv = document.getElementsByClassName('pst-async-banner-revealer')[0];

    // Add version banner and announcement banner if bannerDiv is valid
    if (bannerDiv) {
        bannerDiv.innerHTML = getBannerHTML();
    }
    
    </script>

    
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.svg" class="logo__image only-light" alt="BeagleBoard Documentation - Home"/>
    <img src="../../../_static/logo.svg" class="logo__image only-dark pst-js-only" alt="BeagleBoard Documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="ms-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../intro/index.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../boards/index.html">
    Boards
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../projects/index.html">
    Projects
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Books
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../accessories/index.html">
    Accessories
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://www.beagleboard.org/about">
    About
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://www.beagleboard.org/donate">
    Donate
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://gsoc.beagleboard.org/">
    GSoC
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-external" href="https://forum.beagleboard.org/c/faq">
    FAQ
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://openbeagle.org/" title="OpenBeagle" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-gitlab fa-lg" aria-hidden="true"></i>
            <span class="sr-only">OpenBeagle</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://docs.beagleboard.org/" title="Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-book fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Docs</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://bbb.io/discord" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://forum.beagleboard.org/" title="Forum" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Forum</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.beagleboard.org" title="BeagleBoard.org" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/images/boris.svg" class="icon-link-image" alt="BeagleBoard.org"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  



  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../intro/index.html">
    Introduction
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../boards/index.html">
    Boards
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../projects/index.html">
    Projects
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../../index.html">
    Books
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../accessories/index.html">
    Accessories
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://www.beagleboard.org/about">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://www.beagleboard.org/donate">
    Donate
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://gsoc.beagleboard.org/">
    GSoC
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-external" href="https://forum.beagleboard.org/c/faq">
    FAQ
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://openbeagle.org/" title="OpenBeagle" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-gitlab fa-lg" aria-hidden="true"></i>
            <span class="sr-only">OpenBeagle</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://docs.beagleboard.org/" title="Docs" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-solid fa-book fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Docs</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://bbb.io/discord" title="Discord" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discord fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Discord</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://forum.beagleboard.org/" title="Forum" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-discourse fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Forum</span></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://www.beagleboard.org" title="BeagleBoard.org" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../../../_static/images/boris.svg" class="icon-link-image" alt="BeagleBoard.org"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">BeagleBone Cookbook</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01basics/basics.html">Basics</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03displays/displays.html">Displays and Other Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04motors/motors.html">Motors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05tips/tips.html">Beyond the Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06iot/iot.html">Internet of Things</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07kernel/kernel.html">The Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08realtime/realtime.html">Real-Time I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09capes/capes.html">Capes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10parts/parts.html">Parts and Suppliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11misc/misc.html">Misc</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../pru-cookbook/index.html">PRU Cookbook</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/01case/case.html">Case Studies - Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/02start/start.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/03details/details.html">Running a Program; Configuring Pins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/04debug/debug.html">Debugging and Benchmarking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/05blocks/blocks.html">Building Blocks - Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/06io/io.html">Accessing More I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/07more/more.html">More Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/08ai/ai.html">Moving to the BeagleBone AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pru-cookbook/projects.html">PRU Projects</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item"><div class="card mb-3">
    <div class="card-header bg-primary text-light fw-bold">
        Why are we doing this?
    </div>
    <div class="card-body">
        <p class="card-text text-dark">
            We believe in making computers open again to democratize technology and empower individuals and organizations to explore, experiment, and create without the constraints of proprietary systems.
        </p>
    </div>
</div>

<div class="card mb-3">
    <div class="card-header bg-warning text-dark fw-bold">
        What are we doing?
    </div>
    <div class="card-body">
        <p class="card-text text-dark">
            We design versatile and affordable single-board computers to provide developers, hobbyists, and educators with a platform for prototyping, experimentation, and production of embedded systems. Our comprehensive documentation, tutorials, and vibrant online community support users in their projects and foster knowledge sharing.
        </p>
    </div>
</div>

<div class="card mb-3">
    <div class="card-header bg-success text-light fw-bold">
        How are we doing it?
    </div>
    <div class="card-body">
        <p class="card-text text-dark">
            Through open-source hardware designs, diverse software support, and active community engagement, we enable users to customize, innovate, and collaborate effortlessly in embedded computing.
        </p>
    </div>
</div>

<div class="card mb-3">
    <div class="card-header bg-dark text-light fw-bold">
        Support us <i class="fa-solid fa-hand-holding-dollar"></i>
    </div>
    <div class="card-body">
        <p class="card-text text-dark">
            The BeagleBoard.org Foundation is a Michigan, USA-based 501(c)(3) non-profit corporation existing to provide education in and collaboration around the design and use of open-source software and hardware in embedded computing.
        </p>
    </div>
    <div class="card-footer d-grid gap-2">
        <a href="https://patreon.com/beagleboard" class="btn btn-danger text-light"><i class="fa-brands fa-patreon"></i> Become a Patreon</a>
        <a href="https://github.com/sponsors/beagleboard" class="btn btn-dark text-light"><i class="fa-brands fa-github"></i> Sponsor on GitHub</a>
    </div>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
<script>

document.addEventListener('DOMContentLoaded', () => {
    // Add primary sidebar toggle button
    const primarySidebar = document.getElementById('pst-primary-sidebar');
    if (primarySidebar) {
        addSidebarToggleButton(
            primarySidebar,
            'primary',
            'sidebar-toggle-btn',
            '<i class="fa-solid fa-caret-left"></i>',
            '<i class="fa-solid fa-caret-right"></i>',
            'after'
        );
    }

    // Add secondary sidebar toggle button
    const secondarySidebar = document.getElementById('pst-secondary-sidebar');
    if (secondarySidebar) {
        addSidebarToggleButton(
            secondarySidebar,
            'secondary',
            'sidebar-toggle-btn',
            '<i class="fa-solid fa-caret-right"></i>',
            '<i class="fa-solid fa-caret-left"></i>',
            'before'
        );
    }

    /**
     * Adds a toggle button for a sidebar with visibility and state management.
     * @param {HTMLElement} sidebar - The sidebar element to toggle.
     * @param {string} key - A unique key for localStorage and button id.
     * @param {string} buttonClass - CSS class for the toggle button.
     * @param {string} collapseHTML - HTML for the button when the sidebar is collapsed.
     * @param {string} expandHTML - HTML for the button when the sidebar is expanded.
     * @param {string} position - Position to insert the button ('before' or 'after').
     */
    function addSidebarToggleButton(sidebar, key, buttonClass, collapseHTML, expandHTML, position) {
        const toggleButton = document.createElement('button');
        toggleButton.id = `toggle-${key}-sidebar`;
        toggleButton.innerHTML = sidebar.classList.contains('collapsed') ? expandHTML : collapseHTML;
        toggleButton.className = buttonClass;

        // Insert the toggle button
        if (position === 'before') {
            sidebar.parentNode.insertBefore(toggleButton, sidebar);
        } else if (position === 'after') {
            sidebar.parentNode.insertBefore(toggleButton, sidebar.nextSibling);
        }

        // Restore collapsed state from localStorage
        const collapsedState = localStorage.getItem(`${key}SidebarCollapsed`) === 'true';
        if (collapsedState) {
            sidebar.classList.add('collapsed');
            toggleButton.innerHTML = expandHTML;
        }

        // Handle toggle button click
        toggleButton.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');

            // Update button content and save state
            if (sidebar.classList.contains('collapsed')) {
                toggleButton.innerHTML = expandHTML;
                localStorage.setItem(`${key}SidebarCollapsed`, 'true');
            } else {
                toggleButton.innerHTML = collapseHTML;
                localStorage.setItem(`${key}SidebarCollapsed`, 'false');
            }
        });

        // Check visibility of the toggle button
        function checkToggleVisibility() {
            const existingToggleButton = document.querySelector(
                `.pst-navbar-icon.sidebar-toggle.${key}-toggle`
            );
            if (existingToggleButton && existingToggleButton.offsetParent !== null) {
                toggleButton.style.display = 'none'; // Hide custom toggle button
            } else {
                toggleButton.style.display = 'block'; // Show custom toggle button
            }
        }

        // Update button visibility if the sidebar is removed
        function updateButtonVisibility() {
            if (window.getComputedStyle(sidebar).display === 'none') {
                toggleButton.remove(); // Remove button if sidebar is hidden
            } else if (!document.querySelector(`#toggle-${key}-sidebar`)) {
                // Re-add the button if missing
                if (position === 'before') {
                    sidebar.parentNode.insertBefore(toggleButton, sidebar);
                } else if (position === 'after') {
                    sidebar.parentNode.insertBefore(toggleButton, sidebar.nextSibling);
                }
            }
        }

        // Initial visibility check
        checkToggleVisibility();
        updateButtonVisibility();

        // Monitor window resize for dynamic button visibility updates
        window.addEventListener('resize', () => {
            checkToggleVisibility();
            updateButtonVisibility();
        });
    }
});

</script>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Books</a></li>
    
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">BeagleBone Cookbook</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Sensors</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="sensors">
<span id="beaglebone-cookbook-sensors"></span><h1>Sensors<a class="headerlink" href="#sensors" title="Link to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although the examples given here are originally for the BeagleBone Black, many will also
work on the other Beagles too.  See the <cite>tabs</cite> for details on running the examples
on other boards.</p>
</div>
<p>In this chapter, you will learn how to sense the physical world with BeagleBone Black.
Various types of electronic sensors, such as cameras and microphones, can be connected
to the Bone using one or more interfaces provided by the standard USB 2.0 host port,
as shown in <a class="reference internal" href="#sensors-host-port"><span class="std std-ref">The USB 2.0 host port</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the examples in the book assume you have cloned the Cookbook
repository on git.beagleboard.org. Go here <a class="reference internal" href="../01basics/basics.html#basics-repo"><span class="std std-ref">Cloning the Cookbook Repository</span></a> for instructions.</p>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
BeagleBone Black</label><div class="sd-tab-content docutils">
<figure class="align-center" id="id27">
<span id="sensors-host-port"></span><img alt="USB Host Port" src="../../../_images/black_hardware_details.webp" />
<figcaption>
<p><span class="caption-number">Fig. 636 </span><span class="caption-text">The USB 2.0 host port</span><a class="headerlink" href="#id27" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The two 46-pin cape headers (called <em>P8</em> and <em>P9</em>) along the long
edges of the board (<a class="reference internal" href="#sensors-p8p9-fig"><span class="std std-ref">Cape Headers P8 and P9</span></a>) provide connections for
cape add-on boards, digital and analog sensors, and more.</p>
<figure class="align-center" id="id28">
<span id="sensors-p8p9-fig"></span><img alt="Cape Headers P8 and P9" src="../../../_images/P8P9_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 637 </span><span class="caption-text">Cape Headers P8 and P9</span><a class="headerlink" href="#id28" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
BeagleY-AI</label><div class="sd-tab-content docutils">
<figure class="align-center" id="id29">
<img alt="BeagleY-AI Front View" src="../../../_images/beagleY-ai-front.png" />
<figcaption>
<p><span class="caption-number">Fig. 638 </span><span class="caption-text">BeagleY-AI Front View</span><a class="headerlink" href="#id29" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The 40-pin hat header along the long
edge of the board provides connections for
hat add-on boards, digital and analog sensors, and more.</p>
</div>
</div>
<p>The simplest kind of sensor provides a single digital status, such as off or on,
and can be handled by an <em>input mode</em> of one of the Bone’s 65 general-purpose input/output
(GPIO) pins. More complex sensors can be connected by using one of the Bone’s seven
analog-to-digital converter (ADC) inputs or several I<sup>2</sup>C buses.</p>
<p><a class="reference internal" href="../03displays/displays.html#beaglebone-cookbook-displays"><span class="std std-ref">Displays and Other Outputs</span></a> discusses some of the <em>output mode</em> usages of the GPIO pins.</p>
<p>All these examples assume that you know how to edit a file (<a class="reference internal" href="../01basics/basics.html#basics-vsc"><span class="std std-ref">Editing Code Using Visual Studio Code</span></a>) and run
it, either within the Visual Studio Code (VSC) integrated development environment (IDE) or from
the command line (<a class="reference internal" href="../05tips/tips.html#tips-shell"><span class="std std-ref">Getting to the Command Shell via SSH</span></a>).</p>
<section id="choosing-a-method-to-connect-your-sensor">
<h2>Choosing a Method to Connect Your Sensor<a class="headerlink" href="#choosing-a-method-to-connect-your-sensor" title="Link to this heading">#</a></h2>
<section id="problem">
<h3>Problem<a class="headerlink" href="#problem" title="Link to this heading">#</a></h3>
<p>You want to acquire and attach a sensor and need to understand your basic options.</p>
</section>
<section id="solution">
<h3>Solution<a class="headerlink" href="#solution" title="Link to this heading">#</a></h3>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
BeagleBones</label><div class="sd-tab-content docutils">
<p><a class="reference internal" href="#sensors-cape-headers"><span class="std std-ref">Some of the many sensor connection options on the Bone.</span></a> shows many of the possibilities for connecting a sensor.</p>
<figure class="align-center" id="id30">
<span id="sensors-cape-headers"></span><img alt="Sensor Connection Modes" src="../../../_images/cape-headers.webp" />
<figcaption>
<p><span class="caption-number">Fig. 639 </span><span class="caption-text">Some of the many sensor connection options on the Bone.</span><a class="headerlink" href="#id30" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
BeagleY-AI</label><div class="sd-tab-content docutils">
<p><a class="reference internal" href="#sensors-hat-headers"><span class="std std-ref">BeagleY-AI pinout</span></a> shows many of the possibilities for connecting a sensor.</p>
<p>You will see pins referenced in several ways. While this is confusing at first, in reality,
we can pick our favorite way and stick to it.</p>
<p>The two main ways of referring to GPIOs is <strong>by their number</strong>, so GPIO2, GPIO3, GPIO4 etc.
as seen in the diagram below. This corresponds
to the SoC naming convention. For broad compatibility, BeagleY-AI re-uses the Broadcom GPIO numbering scheme used by RaspberryPi.</p>
<p>The second (and arguably easier) way we will use for this tutorial is to use the <strong>actual pin header number</strong> (shown in dark grey).  So, for the rest of the tutorial, if we refer to <strong>hat-08-gpio</strong> we mean the <strong>8th pin of the GPIO header</strong>. Which, if you referenced
the image below, can see refers to <strong>GPIO14 (UART TXD)</strong></p>
<figure class="align-center" id="id31">
<span id="sensors-hat-headers"></span><img alt="BeagleY-AI pinout" src="../../../_images/pinout1.png" />
<figcaption>
<p><span class="caption-number">Fig. 640 </span><span class="caption-text">BeagleY-AI pinout</span><a class="headerlink" href="#id31" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Go to <a class="reference external" href="https://pinout.beagleboard.io/">https://pinout.beagleboard.io/</a> to see an interactive version  of the figure.</p>
</div>
</div>
<p>Choosing the simplest solution available enables you to move on quickly to
addressing other system aspects. By exploring each connection type, you can
make more informed decisions as you seek to optimize and troubleshoot your design.</p>
</section>
</section>
<section id="input-and-run-a-python-or-javascript-application-for-talking-to-sensors">
<span id="sensors-getting-started"></span><h2>Input and Run a Python or JavaScript Application for Talking to Sensors<a class="headerlink" href="#input-and-run-a-python-or-javascript-application-for-talking-to-sensors" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Problem<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>You have your sensors all wired up and your Bone booted up, and you need to know how to enter and run your code.</p>
</section>
<section id="id2">
<h3>Solution<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>You are just a few simple steps from running any of the recipes in this book.</p>
<ul class="simple">
<li><p>Plug your Bone into a host computer via the USB cable (<a class="reference internal" href="../01basics/basics.html#basics-out-of-the-box"><span class="std std-ref">Getting Started, Out of the Box</span></a>).</p></li>
<li><p>Start Visual Studio Code (<a class="reference internal" href="../01basics/basics.html#basics-vsc"><span class="std std-ref">Editing Code Using Visual Studio Code</span></a>).</p></li>
<li><p>In the <em>bash</em> tab (as shown in <a class="reference internal" href="#sensors-vsc-bash"><span class="std std-ref">Entering commands in the VSC bash tab</span></a>), run the following commands:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span><span class="nb">cd</span>
bone$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>beaglebone-cookbook-code/02sensors
</pre></div>
</div>
<figure class="align-center" id="id32">
<span id="sensors-vsc-bash"></span><img alt="VSC bash tab" src="../../../_images/vsc-bash-tab.png" />
<figcaption>
<p><span class="caption-number">Fig. 641 </span><span class="caption-text">Entering commands in the VSC bash tab</span><a class="headerlink" href="#id32" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Here, we issued the <em>change directory</em> (<em>cd</em>) command without specifying a target directory.
By default, it takes you to your home directory. Notice that the prompt has changed to reflect the change.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you log in as <em>debian</em>, your home is <em>/home/debian</em>. If you were to create a new user
called <em>newuser</em>, that user’s home would be <em>/home/newuser</em>. By default, all non-root
(non-superuser) users have their home directories in <em>/home</em>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the examples in the book assume you have cloned the
Cookbook repository on git.beagleboard.org. Go here
<a class="reference internal" href="../01basics/basics.html#basics-repo"><span class="std std-ref">Cloning the Cookbook Repository</span></a> for instructions.</p>
</div>
<ul class="simple">
<li><p>Double-click the <em>pushbutton.py</em> file to open it.</p></li>
<li><p>Press ^S (Ctrl-S) to save the file. (You can also go to the File menu in VSC and select Save to save the file, but Ctrl-S is easier.) Even easier, VSC can be configured to autosave every so many seconds.</p></li>
<li><p>In the <em>bash</em> tab, enter the following commands:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>debian@beaglebone:beaglebone-cookbook/code/02sensors$<span class="w"> </span>./pushbutton.py
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
^C
</pre></div>
</div>
<p>This process will work for any script in this book.
(See the following sections for instructions on how to wire the pushbutton.)</p>
</section>
</section>
<section id="reading-the-status-of-a-pushbutton-or-magnetic-switch-passive-on-off-sensor">
<span id="sensors-pushbutton"></span><h2>Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)<a class="headerlink" href="#reading-the-status-of-a-pushbutton-or-magnetic-switch-passive-on-off-sensor" title="Link to this heading">#</a></h2>
<section id="id3">
<h3>Problem<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>You want to read a pushbutton, a magnetic switch, or other sensor that is electrically open or closed.</p>
</section>
<section id="id4">
<h3>Solution<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>Connect the switch to a GPIO pin and read from the proper place in <em>/sys/class/gpio</em>.</p>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>Pushbutton switch.</p></li>
<li><p>Magnetic reed switch. (optional)</p></li>
</ul>
<p>You can wire up either a pushbutton, a magnetic reed switch,
or both on the Bone, as shown in <a class="reference internal" href="#js-pushbutton-fig"><span class="std std-ref">Diagram for wiring a pushbutton and magnetic reed switch input</span></a>.</p>
<figure class="align-center" id="id33">
<span id="js-pushbutton-fig"></span><img alt="Bone with pushbutton" src="../../../_images/pushbutton_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 642 </span><span class="caption-text">Diagram for wiring a pushbutton and magnetic reed switch input</span><a class="headerlink" href="#id33" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The code below reads GPIO port <em>P9_42</em>, which is attached to the pushbutton.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are using a BeagleY-AI, wire the button to <strong>GPIO23</strong> which is <strong>hat-16</strong>.
This also appears at <strong>gpiochip0</strong> and line <strong>7</strong>.</p>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-4">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-number">Listing 20 </span><span class="caption-text">Monitoring a pushbutton (pushbutton.py)</span><a class="headerlink" href="#id34" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1"># //	pushbutton.py</span>
<span class="linenos"> 4</span><span class="c1"># //      Reads P9_42 and prints its value.</span>
<span class="linenos"> 5</span><span class="c1"># //	Wiring:	Connect a switch between P9_42 and 3.3V</span>
<span class="linenos"> 6</span><span class="c1"># //	Setup:	</span>
<span class="linenos"> 7</span><span class="c1"># //	See:	</span>
<span class="linenos"> 8</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">gpiod</span>
<span class="linenos">11</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">100</span>    <span class="c1"># Read time in ms</span>
<span class="linenos">14</span><span class="n">CHIP</span> <span class="o">=</span> <span class="s1">&#39;gpiochip0&#39;</span>
<span class="linenos">15</span><span class="n">LINE_OFFSET</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="c1">#  P9_42 is gpio 7</span>
<span class="linenos">16</span><span class="n">chip</span> <span class="o">=</span> <span class="n">gpiod</span><span class="o">.</span><span class="n">Chip</span><span class="p">(</span><span class="n">CHIP</span><span class="p">)</span>
<span class="linenos">17</span><span class="n">lines</span> <span class="o">=</span> <span class="n">chip</span><span class="o">.</span><span class="n">get_lines</span><span class="p">(</span><span class="n">LINE_OFFSET</span><span class="p">)</span>
<span class="linenos">18</span><span class="n">lines</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">consumer</span><span class="o">=</span><span class="s1">&#39;pushbutton.py&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">gpiod</span><span class="o">.</span><span class="n">LINE_REQ_DIR_IN</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">21</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
<span class="linenos">22</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">23</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/619f6b378f15c0bb16e0051b408f08dd/pushbutton.py"><code class="xref download docutils literal notranslate"><span class="pre">pushbutton.py</span></code></a></p>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-5">
c</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-number">Listing 21 </span><span class="caption-text">Monitoring a pushbutton (pushbutton.c)</span><a class="headerlink" href="#id35" title="Link to this code">#</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos"> 2</span><span class="c1">//	pushbutton.c</span>
<span class="linenos"> 3</span><span class="c1">//      Reads P9_42 and prints its value.</span>
<span class="linenos"> 4</span><span class="c1">//	Wiring:	Connect a switch between P9_42 and 3.3V</span>
<span class="linenos"> 5</span><span class="c1">//	Setup:	</span>
<span class="linenos"> 6</span><span class="c1">//	See:	</span>
<span class="linenos"> 7</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos"> 8</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;gpiod.h&gt;</span>
<span class="linenos"> 9</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos">10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="cp">#define CONSUMER        &quot;pushbutton.c&quot;</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="linenos">15</span><span class="p">{</span>
<span class="linenos">16</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">chipnumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">line_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">gpiod_line</span><span class="w"> </span><span class="o">*</span><span class="n">line</span><span class="p">;</span>
<span class="linenos">19</span><span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">gpiod_chip</span><span class="w"> </span><span class="o">*</span><span class="n">chip</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="w">        </span><span class="n">chip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpiod_chip_open_by_number</span><span class="p">(</span><span class="n">chipnumber</span><span class="p">);</span>
<span class="linenos">23</span><span class="w">        </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpiod_chip_get_line</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span><span class="w"> </span><span class="n">line_num</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpiod_line_request_input</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">CONSUMER</span><span class="p">);</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="w">        </span><span class="cm">/* Get */</span>
<span class="linenos">27</span><span class="w">        </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">28</span><span class="w">                </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">gpiod_line_get_value</span><span class="p">(</span><span class="n">line</span><span class="p">));</span>
<span class="linenos">29</span><span class="w">                </span><span class="n">usleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="linenos">30</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">31</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/d21d45452dae1402f2da44ccec1c8644/pushbutton.c"><code class="xref download docutils literal notranslate"><span class="pre">pushbutton.c</span></code></a></p>
</div>
</div>
<p>Put this code in a file called <em>pushbutton.py</em> following the steps in <a class="reference internal" href="#sensors-getting-started"><span class="std std-ref">Input and Run a Python or JavaScript Application for Talking to Sensors</span></a>.
In the VSC <em>bash</em> tab, run it by using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>./pushbutton.py
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
^C
</pre></div>
</div>
<p>The command runs it. Try pushing the button. The code reads the pin and prints its current value.</p>
<p>You will have to press ^C (Ctrl-C) to stop the code.</p>
<p>If you want to run the C version do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span>pushbutton<span class="w"> </span>pushbutton.c<span class="w"> </span>-lgpiod
bone$<span class="w"> </span>./pushbutton
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
^C
</pre></div>
</div>
<p>If you want to use the magnetic reed switch wired as shown in
<a class="reference internal" href="#js-pushbutton-fig"><span class="std std-ref">Diagram for wiring a pushbutton and magnetic reed switch input</span></a>, change <em>P9_42</em> to <em>P9_26</em> which is gpio <em>14</em>.</p>
</section>
</section>
<section id="mapping-header-numbers-to-gpio-numbers">
<h2>Mapping Header Numbers to gpio Numbers<a class="headerlink" href="#mapping-header-numbers-to-gpio-numbers" title="Link to this heading">#</a></h2>
<section id="id5">
<h3>Problem<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>You have a sensor attached to the P8 or P9 header and need to know which gpio pin it is using.</p>
</section>
<section id="id6">
<h3>Solution<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>The <em>gpioinfo</em> command displays information about all the P8 and P9 header pins.
(Or the HAT header pins if you are on the BeagleY-AI.)
To see the info for just one pin, use <em>grep</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>gpioinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-e<span class="w"> </span>chip<span class="w"> </span>-e<span class="w"> </span>P9.42
gpiochip0<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
<span class="w">        </span>line<span class="w">   </span><span class="m">7</span>:<span class="w"> </span><span class="s2">&quot;P8_42A [ecappwm0]&quot;</span><span class="w"> </span><span class="s2">&quot;P9_42&quot;</span><span class="w"> </span>input<span class="w"> </span>active-high<span class="w"> </span><span class="o">[</span>used<span class="o">]</span>
gpiochip1<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
gpiochip2<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
gpiochip3<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
</pre></div>
</div>
<p>Or, if on the BeagleY-AI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>gpioinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-e<span class="w"> </span>chip<span class="w"> </span>-e<span class="w"> </span>GPIO23
gpiochip0<span class="w"> </span>-<span class="w"> </span><span class="m">24</span><span class="w"> </span>lines:
<span class="w">    </span>line<span class="w">   </span><span class="m">7</span>:<span class="w">     </span><span class="s2">&quot;GPIO23&quot;</span><span class="w">       </span>unused<span class="w">   </span>input<span class="w">  </span>active-high
<span class="w"> </span>gpiochip1<span class="w"> </span>-<span class="w"> </span><span class="m">87</span><span class="w"> </span>lines:
<span class="w"> </span>gpiochip2<span class="w"> </span>-<span class="w"> </span><span class="m">73</span><span class="w"> </span>lines:
</pre></div>
</div>
<p>This shows P9_42 (GPIO32) is on  chip 0 and pin 7.  To find the gpio number multiply
the chip number by 32 and add it to the pin number.  This gives 0*32+7=7.</p>
<p>For P9_26 you get:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>gpioinfo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-e<span class="w"> </span>chip<span class="w"> </span>-e<span class="w"> </span>P9.26
gpiochip0<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
<span class="w">        </span>line<span class="w">  </span><span class="m">14</span>:<span class="w"> </span><span class="s2">&quot;P9_26 [uart1_rxd]&quot;</span><span class="w"> </span><span class="s2">&quot;P9_26&quot;</span><span class="w"> </span>input<span class="w"> </span>active-high<span class="w"> </span><span class="o">[</span>used<span class="o">]</span>
gpiochip1<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
gpiochip2<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
gpiochip3<span class="w"> </span>-<span class="w"> </span><span class="m">32</span><span class="w"> </span>lines:
</pre></div>
</div>
<p>0*32+14=14, so the P9_26 pin is gpio 14.</p>
</section>
</section>
<section id="reading-a-position-light-or-force-sensor-variable-resistance-sensor">
<h2>Reading a Position, Light, or Force Sensor (Variable Resistance Sensor)<a class="headerlink" href="#reading-a-position-light-or-force-sensor-variable-resistance-sensor" title="Link to this heading">#</a></h2>
<section id="id7">
<h3>Problem<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>You have a variable resistor, force-sensitive resistor, flex sensor, or any of a
number of other sensors that output their value as a variable resistance,
and you want to read their value with the Bone.</p>
</section>
<section id="id8">
<h3>Solution<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The BeagleY-AI doesn’t have ADC’s, so you can skip this section.</p>
</div>
<p>Use the Bone’s analog-to-digital converters (ADCs) and a resistor
divider circuit to detect the resistance in the sensor.</p>
<p>The Bone has seven built-in analog inputs that can easily read a
resistive value. <a class="reference internal" href="#sensors-cape-headers-analog"><span class="std std-ref">Seven analog inputs on P9 header</span></a> shows them
on the lower part of the <em>P9</em> header.</p>
<figure class="align-center" id="id36">
<span id="sensors-cape-headers-analog"></span><img alt="Seven analog inputs on the *P9* header" src="../../../_images/cape-headers-analog.png" />
<figcaption>
<p><span class="caption-number">Fig. 643 </span><span class="caption-text">Seven analog inputs on P9 header</span><a class="headerlink" href="#id36" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>10k trimpot or</p></li>
<li><p>Flex resistor (optional)</p></li>
<li><p>22 kΩ resistor</p></li>
</ul>
<section id="a-variable-resistor-with-three-terminals">
<h4>A variable resistor with three terminals<a class="headerlink" href="#a-variable-resistor-with-three-terminals" title="Link to this heading">#</a></h4>
<p><a class="reference internal" href="#sensors-analogin-fig"><span class="std std-ref">Wiring a 10 kΩ variable resistor (trimpot) to an ADC port</span></a> shows a simple variable resistor (trimpot)
wired to the Bone. One end terminal is wired to the ADC 1.8 V power supply on pin <em>P9_32</em>,
and the other end terminal is attached to the ADC ground (<em>P9_34</em>). The middle terminal
is wired to one of the seven analog-in ports (<em>P9_36</em>).</p>
<figure class="align-center" id="id37">
<span id="sensors-analogin-fig"></span><img alt="Analog" src="../../../_images/analogIn_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 644 </span><span class="caption-text">Wiring a 10 kΩ variable resistor (trimpot) to an ADC port</span><a class="headerlink" href="#id37" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The section below shows the code used to read the variable resistor.
Add the code to a file called <em>analogIn.py</em> and run it; then change the resistor and run it again. The voltage read will change.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-6">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-number">Listing 22 </span><span class="caption-text">Reading an analog voltage (analogIn.py)</span><a class="headerlink" href="#id38" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python3</span>
<span class="linenos"> 2</span><span class="c1">#//////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1">#	analogin.py</span>
<span class="linenos"> 4</span><span class="c1"># 	Reads the analog value of the light sensor.</span>
<span class="linenos"> 5</span><span class="c1">#//////////////////////////////////////</span>
<span class="linenos"> 6</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 7</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">pin</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>        <span class="c1"># light sensor, A2, P9_37</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">IIOPATH</span><span class="o">=</span><span class="s1">&#39;/sys/bus/iio/devices/iio:device0/in_voltage&#39;</span><span class="o">+</span><span class="n">pin</span><span class="o">+</span><span class="s1">&#39;_raw&#39;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit ^C to stop&#39;</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">IIOPATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">18</span>    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">19</span>    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">/</span><span class="mi">4096</span>
<span class="linenos">20</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{:.1f}</span><span class="s1">%, </span><span class="si">{:.3f}</span><span class="s1"> V&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.8</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="c1"># // Bone  | Pocket | AIN</span>
<span class="linenos">24</span><span class="c1"># // ----- | ------ | --- </span>
<span class="linenos">25</span><span class="c1"># // P9_39 | P1_19  | 0</span>
<span class="linenos">26</span><span class="c1"># // P9_40 | P1_21  | 1</span>
<span class="linenos">27</span><span class="c1"># // P9_37 | P1_23  | 2</span>
<span class="linenos">28</span><span class="c1"># // P9_38 | P1_25  | 3</span>
<span class="linenos">29</span><span class="c1"># // P9_33 | P1_27  | 4</span>
<span class="linenos">30</span><span class="c1"># // P9_36 | P2_35  | 5</span>
<span class="linenos">31</span><span class="c1"># // P9_35 | P1_02  | 6</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/01992b87cb3c3b03db741303b2c782f2/analogIn.py"><code class="xref download docutils literal notranslate"><span class="pre">analogIn.py</span></code></a></p>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-7">
JavaScript</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-number">Listing 23 </span><span class="caption-text">Reading an analog voltage (analogIn.js)</span><a class="headerlink" href="#id39" title="Link to this code">#</a></div>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">//////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1">//	analogin.js</span>
<span class="linenos"> 4</span><span class="c1">// 	Reads the analog value of the light sensor.</span>
<span class="linenos"> 5</span><span class="c1">//////////////////////////////////////</span>
<span class="linenos"> 6</span><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="p">;</span><span class="w">  </span><span class="c1">// Time in milliseconds</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">const</span><span class="w"> </span><span class="nx">pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">;</span><span class="w">        </span><span class="c1">// light sensor, A2, P9_37</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kd">const</span><span class="w"> </span><span class="nx">IIOPATH</span><span class="o">=</span><span class="s1">&#39;/sys/bus/iio/devices/iio:device0/in_voltage&#39;</span><span class="o">+</span><span class="nx">pin</span><span class="o">+</span><span class="s1">&#39;_raw&#39;</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hit ^C to stop&#39;</span><span class="p">);</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1">// Read every 500ms</span>
<span class="linenos">16</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">readPin</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="kd">function</span><span class="w"> </span><span class="nx">readPin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">IIOPATH</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos">20</span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="linenos">21</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">22</span><span class="c1">// Bone  | Pocket | AIN</span>
<span class="linenos">23</span><span class="c1">// ----- | ------ | --- </span>
<span class="linenos">24</span><span class="c1">// P9_39 | P1_19  | 0</span>
<span class="linenos">25</span><span class="c1">// P9_40 | P1_21  | 1</span>
<span class="linenos">26</span><span class="c1">// P9_37 | P1_23  | 2</span>
<span class="linenos">27</span><span class="c1">// P9_38 | P1_25  | 3</span>
<span class="linenos">28</span><span class="c1">// P9_33 | P1_27  | 4</span>
<span class="linenos">29</span><span class="c1">// P9_36 | P2_35  | 5</span>
<span class="linenos">30</span><span class="c1">// P9_35 | P1_02  | 6</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/fb773922c93283f34737f253d6aff3e7/analogIn.js"><code class="xref download docutils literal notranslate"><span class="pre">analogIn.js</span></code></a></p>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The code above outputs a value between 0 and 4096.</p>
</div>
</section>
<section id="a-variable-resistor-with-two-terminals">
<h4>A variable resistor with two terminals<a class="headerlink" href="#a-variable-resistor-with-two-terminals" title="Link to this heading">#</a></h4>
<p>Some resistive sensors have only two terminals, such as the flex sensor in <a class="reference internal" href="#sensors-flexresistor-fig"><span class="std std-ref">Reading a two-terminal flex resistor</span></a>
The resistance between its two terminals changes when it is flexed.
In this case, we need to add a fixed resistor in series with the flex sensor. <a class="reference internal" href="#sensors-flexresistor-fig"><span class="std std-ref">Reading a two-terminal flex resistor</span></a>
shows how to wire in a 22 kΩ resistor to give a voltage to measure
across the flex sensor.</p>
<figure class="align-center" id="id40">
<span id="sensors-flexresistor-fig"></span><img alt="Flex Resistor" src="../../../_images/flexResistor_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 645 </span><span class="caption-text">Reading a two-terminal flex resistor</span><a class="headerlink" href="#id40" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The code in <code class="docutils literal notranslate"><span class="pre">analogIn.py</span></code> also works for this setup.</p>
</section>
</section>
</section>
<section id="reading-a-distance-sensor-analog-or-variable-voltage-sensor">
<h2>Reading a Distance Sensor (Analog or Variable Voltage Sensor)<a class="headerlink" href="#reading-a-distance-sensor-analog-or-variable-voltage-sensor" title="Link to this heading">#</a></h2>
<section id="id9">
<h3>Problem<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>You want to measure distance with a <a class="reference external" href="https://www.sparkfun.com/products/11309">LV-MaxSonar-EZ1 Sonar Range Finder</a>,
which outputs a voltage in proportion to the distance.</p>
</section>
<section id="id10">
<h3>Solution<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The BeagleY-AI doesn’t have ADC’s, so you can skip this section.</p>
</div>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>LV-MaxSonar-EZ1 Sonar Range Finder</p></li>
</ul>
<p>All you have to do is wire the EZ1 to one of the Bone’s <em>analog-in</em> pins,
as shown in <a class="reference internal" href="#sensors-ultrasonic-fig"><span class="std std-ref">Wiring the LV-MaxSonar-EZ1 Sonar Range Finder to the P9_33 analog-in port</span></a>. The device outputs ~6.4 mV/in when powered from 3.3 V.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure not to apply more than 1.8 V to the Bone’s <em>analog-in</em>
pins, or you will likely damage them. In practice, this circuit should follow that rule.</p>
</div>
<figure class="align-center" id="id41">
<span id="sensors-ultrasonic-fig"></span><img alt="Analog" src="../../../_images/ultrasonicRange_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 646 </span><span class="caption-text">Wiring the LV-MaxSonar-EZ1 Sonar Range Finder to the <em>P9_33</em> analog-in port</span><a class="headerlink" href="#id41" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">ultrasonicRange.py</span></code> shows the code that reads the sensor at a fixed interval.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-8">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-number">Listing 24 </span><span class="caption-text">Reading an analog voltage (ultrasonicRange.py)</span><a class="headerlink" href="#id42" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># //////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1"># //	ultrasonicRange.js</span>
<span class="linenos"> 4</span><span class="c1"># // 	Reads the analog value of the sensor.</span>
<span class="linenos"> 5</span><span class="c1"># //////////////////////////////////////</span>
<span class="linenos"> 6</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 7</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>  <span class="c1"># Time in milliseconds</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">pin</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>        <span class="c1"># sensor, A0, P9_39</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">IIOPATH</span><span class="o">=</span><span class="s1">&#39;/sys/bus/iio/devices/iio:device0/in_voltage&#39;</span><span class="o">+</span><span class="n">pin</span><span class="o">+</span><span class="s1">&#39;_raw&#39;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hit ^C to stop&#39;</span><span class="p">);</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">IIOPATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="linenos">16</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">17</span>    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">19</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data= &#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="c1"># // Bone  | Pocket | AIN</span>
<span class="linenos">23</span><span class="c1"># // ----- | ------ | --- </span>
<span class="linenos">24</span><span class="c1"># // P9_39 | P1_19  | 0</span>
<span class="linenos">25</span><span class="c1"># // P9_40 | P1_21  | 1</span>
<span class="linenos">26</span><span class="c1"># // P9_37 | P1_23  | 2</span>
<span class="linenos">27</span><span class="c1"># // P9_38 | P1_25  | 3</span>
<span class="linenos">28</span><span class="c1"># // P9_33 | P1_27  | 4</span>
<span class="linenos">29</span><span class="c1"># // P9_36 | P2_35  | 5</span>
<span class="linenos">30</span><span class="c1"># // P9_35 | P1_02  | 6</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/e665115676db87256ede4c51b3aef77b/ultrasonicRange.py"><code class="xref download docutils literal notranslate"><span class="pre">ultrasonicRange.py</span></code></a></p>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-9">
JavaScript</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-number">Listing 25 </span><span class="caption-text">Reading an analog voltage (ultrasonicRange.js)</span><a class="headerlink" href="#id43" title="Link to this code">#</a></div>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">//////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1">//	ultrasonicRange.js</span>
<span class="linenos"> 4</span><span class="c1">// 	Reads the analog value of the sensor.</span>
<span class="linenos"> 5</span><span class="c1">//////////////////////////////////////</span>
<span class="linenos"> 6</span><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250</span><span class="p">;</span><span class="w">  </span><span class="c1">// Time in milliseconds</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">const</span><span class="w"> </span><span class="nx">pin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">;</span><span class="w">        </span><span class="c1">// sensor, A0, P9_39</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kd">const</span><span class="w"> </span><span class="nx">IIOPATH</span><span class="o">=</span><span class="s1">&#39;/sys/bus/iio/devices/iio:device0/in_voltage&#39;</span><span class="o">+</span><span class="nx">pin</span><span class="o">+</span><span class="s1">&#39;_raw&#39;</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hit ^C to stop&#39;</span><span class="p">);</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1">// Read every ms</span>
<span class="linenos">16</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">readPin</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="kd">function</span><span class="w"> </span><span class="nx">readPin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">IIOPATH</span><span class="p">);</span>
<span class="linenos">20</span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data= &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="linenos">21</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">22</span><span class="c1">// Bone  | Pocket | AIN</span>
<span class="linenos">23</span><span class="c1">// ----- | ------ | --- </span>
<span class="linenos">24</span><span class="c1">// P9_39 | P1_19  | 0</span>
<span class="linenos">25</span><span class="c1">// P9_40 | P1_21  | 1</span>
<span class="linenos">26</span><span class="c1">// P9_37 | P1_23  | 2</span>
<span class="linenos">27</span><span class="c1">// P9_38 | P1_25  | 3</span>
<span class="linenos">28</span><span class="c1">// P9_33 | P1_27  | 4</span>
<span class="linenos">29</span><span class="c1">// P9_36 | P2_35  | 5</span>
<span class="linenos">30</span><span class="c1">// P9_35 | P1_02  | 6</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/737089f66a85be63a9a1527853d72951/ultrasonicRange.js"><code class="xref download docutils literal notranslate"><span class="pre">ultrasonicRange.js</span></code></a></p>
</div>
</div>
</section>
</section>
<section id="reading-a-distance-sensor-variable-pulse-width-sensor">
<span id="sensors-hc-sr04"></span><h2>Reading a Distance Sensor (Variable Pulse Width Sensor)<a class="headerlink" href="#reading-a-distance-sensor-variable-pulse-width-sensor" title="Link to this heading">#</a></h2>
<section id="id11">
<h3>Problem<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<p>You want to use a HC-SR04 Ultrasonic Range Sensor with BeagleBone Black.</p>
</section>
<section id="id12">
<h3>Solution<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>The HC-SR04 Ultrasonic Range Sensor (shown in <a class="reference internal" href="#sensors-hc-sr04-image-fig"><span class="std std-ref">HC-SR04 Ultrasonic range sensor</span></a>)
works by sending a trigger pulse to the <em>Trigger</em> input and then measuring the
pulse width on the <em>Echo</em> output. The width of the pulse tells you the distance.</p>
<figure class="align-center" id="id44">
<span id="sensors-hc-sr04-image-fig"></span><img alt="HC-SR04 Ultrasonic Sensor" src="../../../_images/hc-sr04.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 647 </span><span class="caption-text">HC-SR04 Ultrasonic range sensor</span><a class="headerlink" href="#id44" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>10 kΩ and 20 kΩ resistors</p></li>
<li><p>HC-SR04 Ultrsonic Range Sensor.</p></li>
</ul>
<p>Wire the sensor as shown in <a class="reference internal" href="#sensors-hc-sr04-fig"><span class="std std-ref">Wiring an HC-SR04 Ultrasonic Sensor</span></a>.
Note that the HC-SR04 is a 5 V device, so the <em>banded</em> wire (running from
<em>P9_7</em> on the Bone to VCC on the range finder) attaches the
HC-SR04 to the Bone’s 5 V power supply.</p>
<figure class="align-center" id="id45">
<span id="sensors-hc-sr04-fig"></span><img alt="Wiring an HC-SR04 Ultrasonic Sensor" src="../../../_images/hc-sr04-ultraSonic_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 648 </span><span class="caption-text">Wiring an HC-SR04 Ultrasonic Sensor</span><a class="headerlink" href="#id45" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#sensors-hc-sr04-code"><span class="std std-ref">Driving a HC-SR04 ultrasound sensor (hc-sr04-ultraSonic.js)</span></a> shows BoneScript code used to drive the HC-SR04.</p>
<div class="literal-block-wrapper docutils container" id="id46">
<span id="sensors-hc-sr04-code"></span><div class="code-block-caption"><span class="caption-number">Listing 26 </span><span class="caption-text">Driving a HC-SR04 ultrasound sensor (hc-sr04-ultraSonic.js)</span><a class="headerlink" href="#id46" title="Link to this code">#</a></div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="c1">// This is an example of reading HC-SR04 Ultrasonic Range Finder</span>
<span class="linenos"> 4</span><span class="c1">// This version measures from the fall of the Trigger pulse </span>
<span class="linenos"> 5</span><span class="c1">//   to the end of the Echo pulse</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bonescript&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">var</span><span class="w"> </span><span class="nx">trigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P9_16&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Pin to trigger the ultrasonic pulse</span>
<span class="linenos">10</span><span class="w">    </span><span class="nx">echo</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;P9_41&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">// Pin to measure to pulse width related to the distance</span>
<span class="linenos">11</span><span class="w">    </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">250</span><span class="p">;</span><span class="w">           </span><span class="c1">// Trigger period in ms</span>
<span class="linenos">12</span><span class="w">    </span>
<span class="linenos">13</span><span class="kd">var</span><span class="w"> </span><span class="nx">startTime</span><span class="p">,</span><span class="w"> </span><span class="nx">pulseTime</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">    </span>
<span class="linenos">15</span><span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">echo</span><span class="p">,</span><span class="w">   </span><span class="nx">b</span><span class="p">.</span><span class="nx">INPUT</span><span class="p">,</span><span class="w"> </span><span class="mf">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pulldown&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fast&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">doAttach</span><span class="p">);</span>
<span class="linenos">16</span><span class="kd">function</span><span class="w"> </span><span class="nx">doAttach</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">17</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">18</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;x.err = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="nx">err</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">21</span><span class="w">    </span><span class="c1">// Call pingEnd when the pulse ends</span>
<span class="linenos">22</span><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">attachInterrupt</span><span class="p">(</span><span class="nx">echo</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">FALLING</span><span class="p">,</span><span class="w"> </span><span class="nx">pingEnd</span><span class="p">);</span>
<span class="linenos">23</span><span class="p">}</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="nx">b</span><span class="p">.</span><span class="nx">pinMode</span><span class="p">(</span><span class="nx">trigger</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">OUTPUT</span><span class="p">);</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalWrite</span><span class="p">(</span><span class="nx">trigger</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// Unit triggers on a falling edge.</span>
<span class="linenos">28</span><span class="w">                                </span><span class="c1">// Set trigger to high so we call pull it low later</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c1">// Pull the trigger low at a regular interval.</span>
<span class="linenos">31</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">ping</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1">// Pull trigger low and start timing.</span>
<span class="linenos">34</span><span class="kd">function</span><span class="w"> </span><span class="nx">ping</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">35</span><span class="w">    </span><span class="c1">// console.log(&#39;ping&#39;);</span>
<span class="linenos">36</span><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalWrite</span><span class="p">(</span><span class="nx">trigger</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="linenos">37</span><span class="w">    </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">();</span>
<span class="linenos">38</span><span class="p">}</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c1">// Compute the total time and get ready to trigger again.</span>
<span class="linenos">41</span><span class="kd">function</span><span class="w"> </span><span class="nx">pingEnd</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">42</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">attached</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">43</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Interrupt handler attached&quot;</span><span class="p">);</span>
<span class="linenos">44</span><span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="linenos">45</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">46</span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">startTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">47</span><span class="w">        </span><span class="nx">pulseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">hrtime</span><span class="p">(</span><span class="nx">startTime</span><span class="p">);</span>
<span class="linenos">48</span><span class="w">        </span><span class="nx">b</span><span class="p">.</span><span class="nx">digitalWrite</span><span class="p">(</span><span class="nx">trigger</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="linenos">49</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;pulseTime = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">pulseTime</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1000000</span><span class="o">-</span><span class="mf">0.8</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">3</span><span class="p">));</span>
<span class="linenos">50</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">51</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/e21654d4c047460febbecd0adc35f7c3/hc-sr04-ultraSonic.js"><code class="xref download docutils literal notranslate"><span class="pre">hc-sr04-ultraSonic.js</span></code></a></p>
<p>This code is more complex than others in this chapter,
because we have to tell the device when to start
measuring and time the return pulse.</p>
</section>
</section>
<section id="accurately-reading-the-position-of-a-motor-or-dial">
<h2>Accurately Reading the Position of a Motor or Dial<a class="headerlink" href="#accurately-reading-the-position-of-a-motor-or-dial" title="Link to this heading">#</a></h2>
<section id="id13">
<h3>Problem<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<div class="admonition-todo admonition" id="id14">
<p class="admonition-title">Todo</p>
<p>Update for BeagleY-AI</p>
</div>
<p>You have a motor or dial and want to detect rotation using a rotary encoder.</p>
</section>
<section id="id15">
<h3>Solution<a class="headerlink" href="#id15" title="Link to this heading">#</a></h3>
<p>Use a rotary encoder (also called a <em>quadrature encoder</em>) connected to one of
the Bone’s eQEP ports, as shown in <a class="reference internal" href="#digital-rotaryencoder-fig"><span class="std std-ref">Wiring a rotary encoder using eQEP2</span></a>.</p>
<figure class="align-center" id="id47">
<span id="digital-rotaryencoder-fig"></span><img alt="Wiring a rotary encoder using eQEP2" src="../../../_images/rotaryEncoder_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 649 </span><span class="caption-text">Wiring a rotary encoder using eQEP2</span><a class="headerlink" href="#id47" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="pst-scrollable-table-container"><table class="table" id="id48">
<caption><span class="caption-number">Table 141 </span><span class="caption-text">On the BeagleBone and PocketBeage the three encoders are:</span><a class="headerlink" href="#id48" title="Link to this table">#</a></caption>
<tbody>
<tr class="row-odd"><td><p>eQEP0</p></td>
<td><p>P9.27 and P9.42 OR P1_33 and P2_34</p></td>
</tr>
<tr class="row-even"><td><p>eQEP1</p></td>
<td><p>P9.33 and P9.35</p></td>
</tr>
<tr class="row-odd"><td><p>eQEP2</p></td>
<td><p>P8.11 and P8.12 OR P2_24 and P2_33</p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table" id="id49">
<caption><span class="caption-number">Table 142 </span><span class="caption-text">On the AI it’s:</span><a class="headerlink" href="#id49" title="Link to this table">#</a></caption>
<tbody>
<tr class="row-odd"><td><p>eQEP1</p></td>
<td><p>P8.33 and P8.35</p></td>
</tr>
<tr class="row-even"><td><p>eQEP2</p></td>
<td><p>P8.11 and P8.12 or P9.19 and P9.41</p></td>
</tr>
<tr class="row-odd"><td><p>eQEP3</p></td>
<td><p>P8.24 and P8.25 or P9.27 and P9.42</p></td>
</tr>
</tbody>
</table>
</div>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>Rotary encoder.</p></li>
</ul>
<p>We are using a quadrature rotary encoder, which has two switches inside
that open and close in such a manner that you can tell which way the shaft
is turning. In this particular encoder, the two switches have a common lead,
which is wired to ground. It also has a pushbutton switch wired to the other
side of the device, which we aren’t using.</p>
<p>Wire the encoder to <em>P8_11</em> and <em>P8_12</em>, as shown in <a class="reference internal" href="#digital-rotaryencoder-fig"><span class="std std-ref">Wiring a rotary encoder using eQEP2</span></a>.</p>
<p>BeagleBone Black has built-in hardware for reading up to three encoders.
Here, we’ll use the <em>eQEP2</em> encoder via the Linux <em>count</em> subsystem.</p>
<p>Then run the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>config-pin<span class="w"> </span>P8_11<span class="w"> </span>qep
bone$<span class="w"> </span>config-pin<span class="w"> </span>P8_12<span class="w"> </span>qep
bone$<span class="w"> </span>show-pins<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>qep
P8.12<span class="w">        </span><span class="m">12</span><span class="w"> </span>fast<span class="w"> </span>rx<span class="w">  </span>up<span class="w">  </span><span class="m">4</span><span class="w"> </span>qep<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>A<span class="w">    </span>ocp/P8_12_pinmux<span class="w"> </span><span class="o">(</span>pinmux_P8_12_qep_pin<span class="o">)</span>
P8.11<span class="w">        </span><span class="m">13</span><span class="w"> </span>fast<span class="w"> </span>rx<span class="w">  </span>up<span class="w">  </span><span class="m">4</span><span class="w"> </span>qep<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>B<span class="w">    </span>ocp/P8_11_pinmux<span class="w"> </span><span class="o">(</span>pinmux_P8_11_qep_pin<span class="o">)</span>
</pre></div>
</div>
<p>This will enable <em>eQEP2</em> on pins <em>P8_11</em> and <em>P8_12</em>.
The <em>2</em> after the <em>qep</em> returned by <em>show-pins</em> shows it’s <em>eQEP2</em>.</p>
<p>Finally, add the code below to a file named <em>rotaryEncoder.py</em> and run it.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-10" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-10">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-number">Listing 27 </span><span class="caption-text">Reading a rotary encoder (rotaryEncoder.py)</span><a class="headerlink" href="#id50" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># // This uses the eQEP hardware to read a rotary encoder</span>
<span class="linenos"> 3</span><span class="c1"># // bone$ config-pin P8_11 eqep</span>
<span class="linenos"> 4</span><span class="c1"># // bone$ config-pin P8_12 eqep</span>
<span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 6</span>    
<span class="linenos"> 7</span><span class="n">eQEP</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
<span class="linenos"> 8</span><span class="n">COUNTERPATH</span> <span class="o">=</span> <span class="s1">&#39;/dev/bone/counter/counter&#39;</span><span class="o">+</span><span class="n">eQEP</span><span class="o">+</span><span class="s1">&#39;/count0&#39;</span>
<span class="linenos"> 9</span>	
<span class="linenos">10</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">100</span> 	<span class="c1"># Time between samples in ms</span>
<span class="linenos">11</span><span class="n">maxCount</span> <span class="o">=</span> <span class="s1">&#39;1000000&#39;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># Set the eEQP maximum count</span>
<span class="linenos">14</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/ceiling&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">maxCount</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># Enable</span>
<span class="linenos">19</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/enable&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="linenos">21</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/count&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="n">olddata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos">26</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">27</span>	<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">28</span>	<span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">29</span>	<span class="c1"># Print only if data changes</span>
<span class="linenos">30</span>	<span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="n">olddata</span><span class="p">:</span>
<span class="linenos">31</span>		<span class="n">olddata</span> <span class="o">=</span> <span class="n">data</span>
<span class="linenos">32</span>		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data = &quot;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
<span class="linenos">33</span>	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="c1"># Black OR Pocket</span>
<span class="linenos">36</span><span class="c1"># eQEP0:	P9.27 and P9.42 OR P1_33 and P2_34</span>
<span class="linenos">37</span><span class="c1"># eQEP1:	P9.33 and P9.35</span>
<span class="linenos">38</span><span class="c1"># eQEP2:	P8.11 and P8.12 OR P2_24 and P2_33</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c1"># AI</span>
<span class="linenos">41</span><span class="c1"># eQEP1:	P8.33 and P8.35</span>
<span class="linenos">42</span><span class="c1"># eQEP2:	P8.11 and P8.12 or P9.19 and P9.41</span>
<span class="linenos">43</span><span class="c1"># eQEP3:	P8.24 and P8.25 or P9.27 and P9.42</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/6a9d07beb82717eb881b9f73c620215a/rotaryEncoder.py"><code class="xref download docutils literal notranslate"><span class="pre">rotaryEncoder.py</span></code></a></p>
</div>
<input id="sd-tab-item-11" name="sd-tab-set-5" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-11">
JavaScript</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-number">Listing 28 </span><span class="caption-text">Reading a rotary encoder (rotaryEncoder.js)</span><a class="headerlink" href="#id51" title="Link to this code">#</a></div>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">// This uses the eQEP hardware to read a rotary encoder</span>
<span class="linenos"> 3</span><span class="c1">// bone$ config-pin P8_11 eqep</span>
<span class="linenos"> 4</span><span class="c1">// bone$ config-pin P8_12 eqep</span>
<span class="linenos"> 5</span><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="linenos"> 6</span><span class="w">    </span>
<span class="linenos"> 7</span><span class="kd">const</span><span class="w"> </span><span class="nx">eQEP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="kd">const</span><span class="w"> </span><span class="nx">COUNTERPATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/dev/bone/counter/counter&#39;</span><span class="o">+</span><span class="nx">eQEP</span><span class="o">+</span><span class="s1">&#39;/count0&#39;</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">	</span>
<span class="linenos">10</span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w"> 	</span><span class="c1">// Time between samples in ms</span>
<span class="linenos">11</span><span class="kd">const</span><span class="w"> </span><span class="nx">maxCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1000000&#39;</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1">// Set the eEQP maximum count</span>
<span class="linenos">14</span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/ceiling&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">maxCount</span><span class="p">);</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1">// Enable</span>
<span class="linenos">17</span><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/enable&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">);</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">readEncoder</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span><span class="w">    </span><span class="c1">// Check state every ms</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="kd">var</span><span class="w"> </span><span class="nx">olddata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">;</span>
<span class="linenos">22</span><span class="kd">function</span><span class="w"> </span><span class="nx">readEncoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">23</span><span class="w">	</span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">COUNTERPATH</span><span class="o">+</span><span class="s1">&#39;/count&#39;</span><span class="p">));</span>
<span class="linenos">24</span><span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">olddata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">25</span><span class="w">		</span><span class="c1">// Print only if data changes</span>
<span class="linenos">26</span><span class="w">		</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
<span class="linenos">27</span><span class="w">		</span><span class="nx">olddata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
<span class="linenos">28</span><span class="w">	</span><span class="p">}</span><span class="w"> </span>
<span class="linenos">29</span><span class="p">}</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="c1">// Black OR Pocket</span>
<span class="linenos">32</span><span class="c1">// eQEP0:	P9.27 and P9.42 OR P1_33 and P2_34</span>
<span class="linenos">33</span><span class="c1">// eQEP1:	P9.33 and P9.35</span>
<span class="linenos">34</span><span class="c1">// eQEP2:	P8.11 and P8.12 OR P2_24 and P2_33</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="c1">// AI</span>
<span class="linenos">37</span><span class="c1">// eQEP1:	P8.33 and P8.35</span>
<span class="linenos">38</span><span class="c1">// eQEP2:	P8.11 and P8.12 or P9.19 and P9.41</span>
<span class="linenos">39</span><span class="c1">// eQEP3:	P8.24 and P8.25 or P9.27 and P9.42</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/fca1d80a3f58ed7ecd8b0a405f29c0b9/rotaryEncoder.js"><code class="xref download docutils literal notranslate"><span class="pre">rotaryEncoder.js</span></code></a></p>
</div>
</div>
<p>Try rotating the encoder clockwise and counter-clockwise.
You’ll see an output like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">32</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">44</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">48</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">39</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">22</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999989</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999973</span>
<span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999972</span>
^C
</pre></div>
</div>
<p>The values you get for <em>data</em> will depend on which way you are
turning the device and how quickly. You will need to press ^C (Ctrl-C) to end.</p>
</section>
<section id="see-also">
<h3>See Also<a class="headerlink" href="#see-also" title="Link to this heading">#</a></h3>
<p>You can also measure rotation by using a variable resistor (see <a class="reference internal" href="#sensors-analogin-fig"><span class="std std-ref">Wiring a 10 kΩ variable resistor (trimpot) to an ADC port</span></a>).</p>
</section>
</section>
<section id="acquiring-data-by-using-a-smart-sensor-over-a-serial-connection">
<span id="sensors-gps"></span><h2>Acquiring Data by Using a Smart Sensor over a Serial Connection<a class="headerlink" href="#acquiring-data-by-using-a-smart-sensor-over-a-serial-connection" title="Link to this heading">#</a></h2>
<section id="id16">
<h3>Problem<a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>You want to connect a smart sensor that uses a built-in microcontroller to stream data,
such as a global positioning system (GPS), to the Bone and read the data from it.</p>
</section>
<section id="id17">
<h3>Solution<a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<p>The Bone has several serial ports (UARTs) that you can use to read data from an external
microcontroller included in smart sensors, such as a GPS. Just wire one up, and you’ll
soon be gathering useful data, such as your own location.</p>
<p>Here’s what you’ll need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>GPS receiver</p></li>
</ul>
<p>Wire your GPS, as shown in <a class="reference internal" href="#digital-gps-fig"><span class="std std-ref">Wiring a GPS to UART 4</span></a>.</p>
<figure class="align-center" id="id52">
<span id="digital-gps-fig"></span><img alt="Wiring a GPS to UART 4" src="../../../_images/GPS_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 650 </span><span class="caption-text">Wiring a GPS to UART 4</span><a class="headerlink" href="#id52" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The GPS will produce raw National Marine Electronics Association (NMEA)
data that’s easy for a computer to read, but not for a human.
There are many utilities to help convert such sensor data into a
human-readable form. For this GPS, run the following command to load a NMEA parser:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>nmea
</pre></div>
</div>
<p>Running the code in <a class="reference internal" href="#digital-gps-code"><span class="std std-ref">Talking to a GPS with UART 4 (GPS.js)</span></a>
will print the current location every time the GPS outputs it.</p>
<div class="literal-block-wrapper docutils container" id="id53">
<span id="digital-gps-code"></span><div class="code-block-caption"><span class="caption-number">Listing 29 </span><span class="caption-text">Talking to a GPS with UART 4 (GPS.js)</span><a class="headerlink" href="#id53" title="Link to this code">#</a></div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">// Install with: npm install nmea</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1">// Need to add exports.serialParsers = m.module.parsers;</span>
<span class="linenos"> 5</span><span class="c1">// to the end of /usr/local/lib/node_modules/bonescript/serial.js</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bonescript&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="kd">var</span><span class="w"> </span><span class="nx">nmea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;nmea&#39;</span><span class="p">);</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kd">var</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/dev/ttyO4&#39;</span><span class="p">;</span>
<span class="linenos">11</span><span class="kd">var</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">    </span><span class="nx">baudrate</span><span class="o">:</span><span class="w"> </span><span class="mf">9600</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">    </span><span class="nx">parser</span><span class="o">:</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">serialParsers</span><span class="p">.</span><span class="nx">readline</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span>
<span class="linenos">14</span><span class="p">};</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="nx">b</span><span class="p">.</span><span class="nx">serialOpen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="nx">onSerial</span><span class="p">);</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="kd">function</span><span class="w"> </span><span class="nx">onSerial</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;***ERROR*** &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="linenos">21</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">22</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">23</span><span class="w">       </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;***OPENED***&#39;</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">25</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">26</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
<span class="linenos">27</span><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nmea</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
<span class="linenos">28</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">29</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/7cfed7350d7adad16d26687043345306/GPS.js"><code class="xref download docutils literal notranslate"><span class="pre">GPS.js</span></code></a></p>
<p>If you don’t need the NMEA formatting, you can skip the <em>npm</em> part and remove the lines in the code that refer to it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you get an error like this
<em>TypeError: Cannot call method ‘readline’ of undefined</em></p>
<blockquote>
<div><p>add this line to the end of file <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/node_modules/bonescript/serial.js</span></code>:</p>
<p><em>exports.serialParsers = m.module.parsers;</em></p>
</div></blockquote>
</div>
<figure class="align-center" id="id54">
<span id="cape-headers-serial-fig"></span><img alt="UART outputs" src="../../../_images/cape-headers-serial.png" />
<figcaption>
<p><span class="caption-number">Fig. 651 </span><span class="caption-text">Table of UART outputs</span><a class="headerlink" href="#id54" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="measuring-a-temperature">
<span id="sensors-i2c-temp"></span><h2>Measuring a Temperature<a class="headerlink" href="#measuring-a-temperature" title="Link to this heading">#</a></h2>
<section id="id18">
<h3>Problem<a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p>You want to measure a temperature using a digital temperature sensor.</p>
</section>
<section id="id19">
<h3>Solution<a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<p>The TMP101 sensor is a common digital temperature
sensor that uses a standard I<sup>2</sup>C-based serial protocol.</p>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>Two 4.7 kΩ resistors.</p></li>
<li><p>TMP101 temperature sensor.</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-6" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-12">
BeagleBone</label><div class="sd-tab-content docutils">
<p>Wire the TMP101, as shown in <a class="reference internal" href="#sensors-i2ctemp-fig"><span class="std std-ref">Wiring an I2C TMP101 temperature sensor</span></a>.</p>
<figure class="align-center" id="id55">
<span id="sensors-i2ctemp-fig"></span><img alt="|I2C| Temp" src="../../../_images/i2cTemp_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 652 </span><span class="caption-text">Wiring an I<sup>2</sup>C TMP101 temperature sensor</span><a class="headerlink" href="#id55" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>There are two I<sup>2</sup>C buses brought out to the headers.
<a class="reference internal" href="#sensors-cape-headers-i2c"><span class="std std-ref">Table of I2C outputs</span></a>
shows that you have wired your device to I<sup>2</sup>C bus <em>2</em>.</p>
<figure class="align-center" id="id56">
<span id="sensors-cape-headers-i2c"></span><img alt="Table of |I2C| outputs" src="../../../_images/cape-headers-i2c.png" />
<figcaption>
<p><span class="caption-number">Fig. 653 </span><span class="caption-text">Table of I<sup>2</sup>C outputs</span><a class="headerlink" href="#id56" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-6" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-13">
BeagleY-AI</label><div class="sd-tab-content docutils">
<p>Running the following on the BeagleY-AI shows it has five i2c buses.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">bone$ ls /sys/bus/i2c/devices/</span>
<span class="go">2-0030  2-0050  2-0068  4-004c  i2c-1  i2c-2  i2c-3  i2c-4  i2c-5</span>
</pre></div>
</div>
<p>But running <a class="reference external" href="https://pinout.beagleboard.io/">https://pinout.beagleboard.io/</a> show only buses 1 and 4 are exposed on the HAT header.
Here we’ll use bus 2 whose clock appears on <cite>hat-03</cite> and data on <cite>hat-05</cite>.</p>
<p>Wire your <strong>tmp101</strong> as shown in the table.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Function</p></th>
<th class="head"><p>hat</p></th>
<th class="head"><p>tmp101</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ground</p></td>
<td><p>09</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>3.3V</p></td>
<td><p>01</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>data</p></td>
<td><p>03</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>clock</p></td>
<td><p>05</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Once the I<sup>2</sup>C device is wired up, you can use a couple handy I<sup>2</sup>C
tools to test the device. Because these are Linux command-line tools,
you have to use <em>2</em> as the bus number. <em>i2cdetect</em>, shown in <a class="reference internal" href="#js-i2ctools"><span class="std std-ref">I2C tools</span></a>,
shows which I<sup>2</sup>C devices are on the bus. The <em>-r</em> flag indicates which bus to use.
Our TMP101 is appearing at address <em>0x49</em>. You can use the <em>i2cget</em> command to read
the value. It returns the temperature in hexadecimal and degrees C.
In this example, 0x18 = 24{deg}C, which is 75.2{deg}F. (Hmmm, the office is a bit warm today.)
Try warming up the TMP101 with your finger and running <em>i2cget</em> again.</p>
<div class="admonition-todo admonition" id="id20">
<p class="admonition-title">Todo</p>
<p>fix deg</p>
</div>
</section>
</section>
<section id="i2c-tools">
<span id="js-i2ctools"></span><h2>I<sup>2</sup>C tools<a class="headerlink" href="#i2c-tools" title="Link to this heading">#</a></h2>
<p>One way to see what devices are on a given I<sup>2</sup>C bus is to use <cite>i2cdetect</cite>.
Here is bus 2 on the BeagleBone.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>i2cdetect<span class="w"> </span>-y<span class="w"> </span>-r<span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span><span class="w">  </span>a<span class="w">  </span>b<span class="w">  </span>c<span class="w">  </span>d<span class="w">  </span>e<span class="w">  </span>f
<span class="w">  </span><span class="m">00</span>:<span class="w">          </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">10</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">20</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">30</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">40</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span><span class="m">49</span><span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">50</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>UU<span class="w"> </span>UU<span class="w"> </span>UU<span class="w"> </span>UU<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">60</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">70</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--

bone$<span class="w"> </span>i2cget<span class="w"> </span>-y<span class="w"> </span><span class="m">2</span><span class="w"> </span>0x49
<span class="w">  </span>0x18
</pre></div>
</div>
<p>Here is bus 1 on the BeagleY-AI.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>i2cdetect<span class="w"> </span>-y<span class="w"> </span>-r<span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span><span class="w">  </span>a<span class="w">  </span>b<span class="w">  </span>c<span class="w">  </span>d<span class="w">  </span>e<span class="w">  </span>f
<span class="w">  </span><span class="m">00</span>:<span class="w">          </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">10</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">20</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">30</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">40</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span><span class="m">49</span><span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">50</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">60</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--
<span class="w">  </span><span class="m">70</span>:<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--<span class="w"> </span>--

bone$<span class="w"> </span>i2cget<span class="w"> </span>-y<span class="w"> </span><span class="m">1</span><span class="w"> </span>0x49
<span class="w">  </span>0x18
</pre></div>
</div>
</section>
<section id="reading-the-temperature-via-the-kernel-driver">
<h2>Reading the temperature via the kernel driver<a class="headerlink" href="#reading-the-temperature-via-the-kernel-driver" title="Link to this heading">#</a></h2>
<p>The cleanest way to read the temperature from at TMP101 sensor is to use the kernel driver.</p>
<p>Assuming the TMP101 is on bus 2 (the last digit is the bus number)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Switch bus 2 to bus 1 if you are using the BeagleY-AI.</p>
</div>
<p id="js-i2ckernel">I<sup>2</sup>C TMP101 via Kernel</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/sys/class/i2c-adapter/
bone$<span class="w"> </span>ls
i2c-0<span class="w">  </span>i2c-1<span class="w">  </span>i2c-2<span class="w">                   </span><span class="c1"># Three i2c buses (bus 0 is internal)</span>
bone$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>i2c-2<span class="w">        </span><span class="c1"># Pick bus 2</span>
bone$<span class="w"> </span>ls<span class="w"> </span>-ls
<span class="m">0</span><span class="w"> </span>--w--w----<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">09</span>:24<span class="w"> </span>delete_device
<span class="m">0</span><span class="w"> </span>lrwxrwxrwx<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w">    </span><span class="m">0</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">16</span>:25<span class="w"> </span>device<span class="w"> </span>-&gt;<span class="w"> </span>../../4819c000.i2c
<span class="m">0</span><span class="w"> </span>drwxrwxr-x<span class="w"> </span><span class="m">3</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w">    </span><span class="m">0</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">31</span><span class="w">  </span><span class="m">1999</span><span class="w"> </span>i2c-dev
<span class="m">0</span><span class="w"> </span>-r--r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">31</span><span class="w">  </span><span class="m">1999</span><span class="w"> </span>name
<span class="m">0</span><span class="w"> </span>--w--w----<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">09</span>:24<span class="w"> </span>new_device
<span class="m">0</span><span class="w"> </span>lrwxrwxrwx<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w">    </span><span class="m">0</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">16</span>:25<span class="w"> </span>of_node<span class="w"> </span>-&gt;<span class="w"> </span>../../../../../../../../firmware/devicetree/base/ocp/interconnect@48000000/segment@100000/target-module@9c000/i2c@0
<span class="m">0</span><span class="w"> </span>drwxrwxr-x<span class="w"> </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w">    </span><span class="m">0</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">31</span><span class="w">  </span><span class="m">1999</span><span class="w"> </span>power
<span class="m">0</span><span class="w"> </span>lrwxrwxrwx<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w">    </span><span class="m">0</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">16</span>:25<span class="w"> </span>subsystem<span class="w"> </span>-&gt;<span class="w"> </span>../../../../../../../../bus/i2c
<span class="m">0</span><span class="w"> </span>-rw-rw-r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>gpio<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">31</span><span class="w">  </span><span class="m">1999</span><span class="w"> </span>uevent
</pre></div>
</div>
<p>Assuming the TMP101 is at address 0x49</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>tmp101<span class="w"> </span>0x49<span class="w"> </span>&gt;<span class="w"> </span>new_device
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If this returns <cite>new_device: Permission denied</cite>, you will need to run the following first.</p>
<blockquote>
<div><p>bone$ sudo chown debian:gpio *</p>
</div></blockquote>
</div>
<p>This tells the kernel you have a TMP101 sensor at address 0x49. Check the log to be sure.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>dmesg<span class="w"> </span>-H<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-3
<span class="o">[</span><span class="w"> </span>+13.571823<span class="o">]</span><span class="w"> </span>i2c<span class="w"> </span>i2c-2:<span class="w"> </span>new_device:<span class="w"> </span>Instantiated<span class="w"> </span>device<span class="w"> </span>tmp101<span class="w"> </span>at<span class="w"> </span>0x49
<span class="o">[</span><span class="w">  </span>+0.043362<span class="o">]</span><span class="w"> </span>lm75<span class="w"> </span><span class="m">2</span>-0049:<span class="w"> </span>supply<span class="w"> </span>vs<span class="w"> </span>not<span class="w"> </span>found,<span class="w"> </span>using<span class="w"> </span>dummy<span class="w"> </span>regulator
<span class="o">[</span><span class="w">  </span>+0.009976<span class="o">]</span><span class="w"> </span>lm75<span class="w"> </span><span class="m">2</span>-0049:<span class="w"> </span>hwmon0:<span class="w"> </span>sensor<span class="w"> </span><span class="s1">&#39;tmp101&#39;</span>
</pre></div>
</div>
<p>Yes, it’s there, now see what happened.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>ls
<span class="m">2</span>-0049<span class="w">  </span>delete_device<span class="w">  </span>device<span class="w">  </span>i2c-dev<span class="w">  </span>name<span class="w"> </span>new_device<span class="w">  </span>of_node<span class="w">  </span>power<span class="w">  </span>subsystem<span class="w">  </span>uevent
</pre></div>
</div>
<p>Notice a new directory has appeared. It’s for i2c bus 2, address 0x49. Look into it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="m">2</span>-0049/hwmon/hwmon0
bone$<span class="w"> </span>ls<span class="w"> </span>-F
device@<span class="w">  </span>name<span class="w">  </span>power/<span class="w">  </span>subsystem@<span class="w">  </span>temp1_input<span class="w">  </span>temp1_max<span class="w"> </span>temp1_max_hyst<span class="w">  </span>uevent<span class="w">  </span>update_interval
bone$<span class="w"> </span>cat<span class="w"> </span>temp1_input
<span class="m">24250</span>
</pre></div>
</div>
<p>There is the temperature in milli-degrees C.</p>
<p>Other i2c devices are supported by the kernel.
You can try the Linux Kernel Driver Database,
<a class="reference external" href="https://cateee.net/lkddb/">https://cateee.net/lkddb/</a> to see them.</p>
<p>Once the driver is in place, you can read it via code.
<code class="docutils literal notranslate"><span class="pre">i2cTemp.py`</span></code> shows how to read the TMP101.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-14" name="sd-tab-set-7" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-14">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id57">
<div class="code-block-caption"><span class="caption-number">Listing 30 </span><span class="caption-text">Reading an I<sup>2</sup>C  device (i2cTemp.py)</span><a class="headerlink" href="#id57" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1"># //	i2cTemp.py</span>
<span class="linenos"> 4</span><span class="c1"># //      Read a TMP101 sensor on i2c bus 2, address 0x49</span>
<span class="linenos"> 5</span><span class="c1"># //	Wiring:	Attach to i2c as shown in text.</span>
<span class="linenos"> 6</span><span class="c1"># //	Setup:	echo tmp101 0x49 &gt; /sys/class/i2c-adapter/i2c-2/new_device</span>
<span class="linenos"> 7</span><span class="c1"># //	See:	</span>
<span class="linenos"> 8</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">1000</span>   <span class="c1"># Read time in ms</span>
<span class="linenos">12</span><span class="n">bus</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
<span class="linenos">13</span><span class="n">addr</span> <span class="o">=</span> <span class="s1">&#39;49&#39;</span>
<span class="linenos">14</span><span class="n">I2CPATH</span><span class="o">=</span><span class="s1">&#39;/sys/class/i2c-adapter/i2c-&#39;</span><span class="o">+</span><span class="n">bus</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">bus</span><span class="o">+</span><span class="s1">&#39;-00&#39;</span><span class="o">+</span><span class="n">addr</span><span class="o">+</span><span class="s1">&#39;/hwmon/hwmon0&#39;</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">I2CPATH</span><span class="o">+</span><span class="s2">&quot;/temp1_input&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">19</span>    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># returns mili-degrees C</span>
<span class="linenos">21</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data (C) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
<span class="linenos">22</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/794c2f538cc8d95480ad0b5f83d346db/i2cTemp.py"><code class="xref download docutils literal notranslate"><span class="pre">i2cTemp.py</span></code></a></p>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-7" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-15">
JavaScript</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-number">Listing 31 </span><span class="caption-text">Reading an I<sup>2</sup>C  device (i2cTemp.js)</span><a class="headerlink" href="#id58" title="Link to this code">#</a></div>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1">//	i2cTemp.js</span>
<span class="linenos"> 4</span><span class="c1">//      Read at TMP101 sensor on i2c bus 2, address 0x49</span>
<span class="linenos"> 5</span><span class="c1">//	Wiring:	Attach to i2c as shown in text.</span>
<span class="linenos"> 6</span><span class="c1">//	Setup:	echo tmp101 0x49 &gt; /sys/class/i2c-adapter/i2c-2/new_device</span>
<span class="linenos"> 7</span><span class="c1">//	See:	</span>
<span class="linenos"> 8</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos"> 9</span><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span><span class="w">   </span><span class="c1">// Read time in ms</span>
<span class="linenos">12</span><span class="kd">const</span><span class="w"> </span><span class="nx">bus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">;</span>
<span class="linenos">13</span><span class="kd">const</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;49&#39;</span><span class="p">;</span>
<span class="linenos">14</span><span class="nx">I2CPATH</span><span class="o">=</span><span class="s1">&#39;/sys/class/i2c-adapter/i2c-&#39;</span><span class="o">+</span><span class="nx">bus</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">bus</span><span class="o">+</span><span class="s1">&#39;-00&#39;</span><span class="o">+</span><span class="nx">addr</span><span class="o">+</span><span class="s1">&#39;/hwmon/hwmon0&#39;</span><span class="p">;</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1">// Read every ms</span>
<span class="linenos">17</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">readTMP</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="kd">function</span><span class="w"> </span><span class="nx">readTMP</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">I2CPATH</span><span class="o">+</span><span class="s2">&quot;/temp1_input&quot;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos">21</span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;data (C) = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="o">/</span><span class="mf">1000</span><span class="p">);</span>
<span class="linenos">22</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/edbee287e17a856c84c154448a76892d/i2cTemp.js"><code class="xref download docutils literal notranslate"><span class="pre">i2cTemp.js</span></code></a></p>
</div>
</div>
<p>Run the code by using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>./i2cTemp.js
data<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span>.625
data<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">27</span>.312
data<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">28</span>.187
data<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">28</span>.375
^C
</pre></div>
</div>
<p>Notice using the kernel interface gets you more digits of accuracy.</p>
</section>
<section id="reading-i2c-device-directly">
<h2>Reading i2c device directly<a class="headerlink" href="#reading-i2c-device-directly" title="Link to this heading">#</a></h2>
<p>The TMP102 sensor can be read directly with i2c commands rather than
using the kernel driver. First you need to install the i2c module.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>python3-smbus
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id59">
<span id="js-i2ctmp101-code"></span><div class="code-block-caption"><span class="caption-number">Listing 32 </span><span class="caption-text">Reading an I<sup>2</sup>C  device (i2cTemp.py)</span><a class="headerlink" href="#id59" title="Link to this code">#</a></div>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1"># //	i2ctmp101.py</span>
<span class="linenos"> 4</span><span class="c1"># //      Read at TMP101 sensor on i2c bus 2, address 0x49</span>
<span class="linenos"> 5</span><span class="c1"># //	Wiring:	Attach to i2c as shown in text.</span>
<span class="linenos"> 6</span><span class="c1"># //	Setup:	pip install smbus</span>
<span class="linenos"> 7</span><span class="c1"># //	See:	</span>
<span class="linenos"> 8</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">smbus</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">1000</span>               <span class="c1"># Read time in ms</span>
<span class="linenos">13</span><span class="n">bus</span> <span class="o">=</span> <span class="n">smbus</span><span class="o">.</span><span class="n">SMBus</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># Using i2c bus 2</span>
<span class="linenos">14</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x49</span>             <span class="c1"># TMP101 is at address 0x49</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">17</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;temp (C) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="linenos">19</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/b86c959abd9d2897aed9e20fa44d3303/i2ctmp101.py"><code class="xref download docutils literal notranslate"><span class="pre">i2ctmp101.py</span></code></a></p>
<p>This gets only 8 bits for the temperature. See the TMP101 datasheet
(<a class="reference external" href="https://www.ti.com/product/TMP101">https://www.ti.com/product/TMP101</a>)
for details on how to get up to 12 bits.</p>
</section>
<section id="reading-temperature-via-a-dallas-1-wire-device">
<h2>Reading Temperature via a Dallas 1-Wire Device<a class="headerlink" href="#reading-temperature-via-a-dallas-1-wire-device" title="Link to this heading">#</a></h2>
<section id="id21">
<h3>Problem<a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<p>You want to measure a temperature using a Dallas Semiconductor DS18B20 temperature sensor.</p>
</section>
<section id="id22">
<h3>Solution<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<div class="admonition-todo admonition" id="id23">
<p class="admonition-title">Todo</p>
<p>Update for BeagleY-AI</p>
</div>
<p>The DS18B20 is an interesting temperature sensor that uses Dallas
Semiconductor’s 1-wire interface. The data communication requires only
one wire! (However, you still need wires from ground and 3.3 V.)
You can wire it to any GPIO port.</p>
<p>To make this recipe, you will need:</p>
<ul class="simple">
<li><p>Breadboard and jumper wires.</p></li>
<li><p>4.7 kΩ resistor</p></li>
<li><p>DS18B20 1-wire temperature sensor.</p></li>
</ul>
<p>Wire up as shown in <a class="reference internal" href="#sensors-1-wire-fig"><span class="std std-ref">Wiring a Dallas 1-Wire temperature sensor</span></a>.</p>
<figure class="align-center" id="id60">
<span id="sensors-1-wire-fig"></span><img alt="1-wire" src="../../../_images/onewire_bb.png" />
<figcaption>
<p><span class="caption-number">Fig. 654 </span><span class="caption-text">Wiring a Dallas 1-Wire temperature sensor</span><a class="headerlink" href="#id60" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Edit the file <em>/boot/uEnt.txt</em>.
Go to about line 19 and edit as shown:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">17</span><span class="w"> </span><span class="c1">###</span>
<span class="m">18</span><span class="w"> </span><span class="c1">###Additional custom capes</span>
<span class="m">19</span><span class="w"> </span><span class="nv">uboot_overlay_addr4</span><span class="o">=</span>BB-W1-P9.12-00A0.dtbo
<span class="m">20</span><span class="w"> </span><span class="c1">#uboot_overlay_addr5=&lt;file5&gt;.dtbo</span>
</pre></div>
</div>
<p>Be sure to remove the <em>#</em> at the beginning of the line.</p>
<p>Reboot the bone:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>reboot
</pre></div>
</div>
<p>Now run the following command to discover the serial number on your device:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>ls<span class="w"> </span>/sys/bus/w1/devices/
<span class="m">28</span>-00000114ef1b<span class="w">  </span><span class="m">28</span>-00000128197d<span class="w">  </span>w1_bus_master1
</pre></div>
</div>
<p>I have two devices wired in parallel on the same P9_12 input.
This shows the serial numbers for all the devices.</p>
<p>Finally, add the code below in to a file named <em>w1.py</em>, edit the path assigned to <em>w1</em> so
that the path points to your device, and then run it.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-16" name="sd-tab-set-8" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-16">
Python</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id61">
<div class="code-block-caption"><span class="caption-number">Listing 33 </span><span class="caption-text">Reading a temperature with a DS18B20 (w1.py)</span><a class="headerlink" href="#id61" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env python</span>
<span class="linenos"> 2</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1"># //	w1.js</span>
<span class="linenos"> 4</span><span class="c1"># //      Read a Dallas 1-wire device on P9_12</span>
<span class="linenos"> 5</span><span class="c1"># //	Wiring:	Attach gnd and 3.3V and data to P9_12</span>
<span class="linenos"> 6</span><span class="c1"># //	Setup:	Edit /boot/uEnv.txt to include:</span>
<span class="linenos"> 7</span><span class="c1"># //              uboot_overlay_addr4=BB-W1-P9.12-00A0.dtbo</span>
<span class="linenos"> 8</span><span class="c1"># //	See:	</span>
<span class="linenos"> 9</span><span class="c1"># ////////////////////////////////////////</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">ms</span> <span class="o">=</span> <span class="mi">500</span>   <span class="c1"># Read time in ms</span>
<span class="linenos">13</span><span class="c1">#  Do ls /sys/bus/w1/devices and find the address of your device</span>
<span class="linenos">14</span><span class="n">addr</span> <span class="o">=</span> <span class="s1">&#39;28-00000d459c2c&#39;</span> <span class="c1"># Must be changed for your device.</span>
<span class="linenos">15</span><span class="n">W1PATH</span> <span class="o">=</span><span class="s1">&#39;/sys/bus/w1/devices/&#39;</span> <span class="o">+</span> <span class="n">addr</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">W1PATH</span><span class="o">+</span><span class="s1">&#39;/temperature&#39;</span><span class="p">)</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">22</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;temp (C) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
<span class="linenos">23</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">ms</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/8352c25600d64cef625889021243a4da/w1.py"><code class="xref download docutils literal notranslate"><span class="pre">w1.py</span></code></a></p>
</div>
<input id="sd-tab-item-17" name="sd-tab-set-8" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-17">
JavaScript</label><div class="sd-tab-content docutils">
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-number">Listing 34 </span><span class="caption-text">Reading a temperature with a DS18B20 (w1.js)</span><a class="headerlink" href="#id62" title="Link to this code">#</a></div>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/env node</span>
<span class="linenos"> 2</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos"> 3</span><span class="c1">//	w1.js</span>
<span class="linenos"> 4</span><span class="c1">//      Read a Dallas 1-wire device on P9_12</span>
<span class="linenos"> 5</span><span class="c1">//	Wiring:	Attach gnd and 3.3V and data to P9_12</span>
<span class="linenos"> 6</span><span class="c1">//	Setup:	Edit /boot/uEnv.txt to include:</span>
<span class="linenos"> 7</span><span class="c1">//              uboot_overlay_addr4=BB-W1-P9.12-00A0.dtbo</span>
<span class="linenos"> 8</span><span class="c1">//	See:	</span>
<span class="linenos"> 9</span><span class="c1">////////////////////////////////////////</span>
<span class="linenos">10</span><span class="kd">const</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="kd">const</span><span class="w"> </span><span class="nx">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span><span class="w">   </span><span class="c1">// Read time in ms</span>
<span class="linenos">13</span><span class="c1">// Do ls /sys/bus/w1/devices and find the address of your device</span>
<span class="linenos">14</span><span class="kd">const</span><span class="w"> </span><span class="nx">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;28-00000d459c2c&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Must be changed for your device.</span>
<span class="linenos">15</span><span class="kd">const</span><span class="w"> </span><span class="nx">W1PATH</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;/sys/bus/w1/devices/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">addr</span><span class="p">;</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c1">// Read every ms</span>
<span class="linenos">18</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">readW1</span><span class="p">,</span><span class="w"> </span><span class="nx">ms</span><span class="p">);</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kd">function</span><span class="w"> </span><span class="nx">readW1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">21</span><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">W1PATH</span><span class="o">+</span><span class="s1">&#39;/temperature&#39;</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">);</span>
<span class="linenos">22</span><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;temp (C) = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="o">/</span><span class="mf">1000</span><span class="p">);</span>
<span class="linenos">23</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/f159339100ca81c220521685258377b9/w1.js"><code class="xref download docutils literal notranslate"><span class="pre">w1.js</span></code></a></p>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>./w1.js
temp<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">28</span>.625
temp<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">29</span>.625
temp<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span>.5
temp<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">31</span>.0
^C
</pre></div>
</div>
<p>Each temperature sensor has a unique serial number, so you can have several all sharing the same data line.</p>
</section>
</section>
<section id="playing-and-recording-audio">
<span id="sensors-audio"></span><h2>Playing and Recording Audio<a class="headerlink" href="#playing-and-recording-audio" title="Link to this heading">#</a></h2>
<div class="admonition-todo admonition" id="id24">
<p class="admonition-title">Todo</p>
<p>Remove?</p>
</div>
<section id="id25">
<h3>Problem<a class="headerlink" href="#id25" title="Link to this heading">#</a></h3>
<p>BeagleBone doesn’t have audio built in, but you want to play and record files.</p>
</section>
<section id="id26">
<h3>Solution<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<p>One approach is to buy an audio cape, but another, possibly cheaper approach is to buy a USB audio adapter,
such as the one shown in <a class="reference internal" href="#usb-audio-dongle"><span class="std std-ref">A USB audio dongle</span></a>.</p>
<figure class="align-center" id="id63">
<span id="usb-audio-dongle"></span><img alt="Audio Dongle" src="../../../_images/audioDongle.jpg" />
<figcaption>
<p><span class="caption-number">Fig. 655 </span><span class="caption-text">A USB audio dongle</span><a class="headerlink" href="#id63" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Drivers for the <a class="reference external" href="http://bit.ly/1MrAJUR">Advanced Linux Sound Architecture</a> (ALSA)
may already installed on the Bone. If not, run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>alsa-utils
</pre></div>
</div>
<p>You can list the recording and playing devices on
your Bone by using <em>aplay</em> and <em>arecord</em>, as shown in <a class="reference internal" href="#sensors-alsa"><span class="std std-ref">Listing the ALSA audio output and input devices on the Bone</span></a>. BeagleBone Black
has audio-out on the HDMI interface. It’s listed as <em>card 0</em> in
<a class="reference internal" href="#sensors-alsa"><span class="std std-ref">Listing the ALSA audio output and input devices on the Bone</span></a>. <em>card 1</em> is my USB audio adapter’s audio out.</p>
</section>
</section>
<section id="listing-the-alsa-audio-output-and-input-devices-on-the-bone">
<span id="sensors-alsa"></span><h2>Listing the ALSA audio output and input devices on the Bone<a class="headerlink" href="#listing-the-alsa-audio-output-and-input-devices-on-the-bone" title="Link to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>aplay<span class="w"> </span>-l
****<span class="w"> </span>List<span class="w"> </span>of<span class="w"> </span>PLAYBACK<span class="w"> </span>Hardware<span class="w"> </span>Devices<span class="w"> </span>****
card<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>Black<span class="w"> </span><span class="o">[</span>TI<span class="w"> </span>BeagleBone<span class="w"> </span>Black<span class="o">]</span>,<span class="w"> </span>device<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>HDMI<span class="w"> </span>nxp-hdmi-hifi-0<span class="w"> </span><span class="o">[]</span>
<span class="w">  </span>Subdevices:<span class="w"> </span><span class="m">1</span>/1
<span class="w">  </span>Subdevice<span class="w"> </span><span class="c1">#0: subdevice #0</span>
card<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Device<span class="w"> </span><span class="o">[</span>C-Media<span class="w"> </span>USB<span class="w"> </span>Audio<span class="w"> </span>Device<span class="o">]</span>,<span class="w"> </span>device<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>USB<span class="w"> </span>Audio<span class="w"> </span><span class="o">[</span>USB<span class="w"> </span>Audio<span class="o">]</span>
<span class="w">  </span>Subdevices:<span class="w"> </span><span class="m">1</span>/1
<span class="w">  </span>Subdevice<span class="w"> </span><span class="c1">#0: subdevice #0</span>

bone$<span class="w"> </span>arecord<span class="w"> </span>-l
****<span class="w"> </span>List<span class="w"> </span>of<span class="w"> </span>CAPTURE<span class="w"> </span>Hardware<span class="w"> </span>Devices<span class="w"> </span>****
card<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Device<span class="w"> </span><span class="o">[</span>C-Media<span class="w"> </span>USB<span class="w"> </span>Audio<span class="w"> </span>Device<span class="o">]</span>,<span class="w"> </span>device<span class="w"> </span><span class="m">0</span>:<span class="w"> </span>USB<span class="w"> </span>Audio<span class="w"> </span><span class="o">[</span>USB<span class="w"> </span>Audio<span class="o">]</span>
<span class="w">  </span>Subdevices:<span class="w"> </span><span class="m">1</span>/1
<span class="w">  </span>Subdevice<span class="w"> </span><span class="c1">#0: subdevice #0</span>
</pre></div>
</div>
<p>In the <em>aplay</em> output shown in <a class="reference internal" href="#sensors-alsa"><span class="std std-ref">Listing the ALSA audio output and input devices on the Bone</span></a>, you can see the
USB adapter’s audio out. By default, the Bone will send audio to the HDMI. You
can change that default by creating a file in your home directory called
<em>~/.asoundrc</em> and adding the code in <a class="reference internal" href="#sensors-asoundrc"><span class="std std-ref">Change the default audio out by putting this in ~/.asoundrc (audio.asoundrc)</span></a> to it.</p>
<div class="literal-block-wrapper docutils container" id="id64">
<span id="sensors-asoundrc"></span><div class="code-block-caption"><span class="caption-number">Listing 35 </span><span class="caption-text">Change the default audio out by putting this in ~/.asoundrc (audio.asoundrc)</span><a class="headerlink" href="#id64" title="Link to this code">#</a></div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">pcm</span><span class="p">.</span><span class="o">!</span><span class="k">default</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="n">type</span><span class="w"> </span><span class="n">plug</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">slave</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">pcm</span><span class="w"> </span><span class="s">&quot;hw:1,0&quot;</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 6</span><span class="p">}</span>
<span class="linenos"> 7</span><span class="n">ctl</span><span class="p">.</span><span class="o">!</span><span class="k">default</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">type</span><span class="w"> </span><span class="n">hw</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">card</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos">10</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p><a class="reference download internal" download="" href="../../../_downloads/a49f02fe0a65c0fae4fd6924db4fabbf/audio.asoundrc"><code class="xref download docutils literal notranslate"><span class="pre">audio.asoundrc</span></code></a></p>
<p>You can easily play <code class="docutils literal notranslate"><span class="pre">.wav</span></code> files with <em>aplay</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>aplay<span class="w"> </span>test.wav
</pre></div>
</div>
<p>You can play other files in other formats by installing <em>mplayer</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bone$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>update
bone$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mplayer
bone$<span class="w"> </span>mplayer<span class="w"> </span>test.mp3
</pre></div>
</div>
<section id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h3>
<p>Adding the simple USB audio adapter opens up a world of audio I/O on the Bone.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../01basics/basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Basics</p>
      </div>
    </a>
    <a class="right-next"
       href="../03displays/displays.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Displays and Other Outputs</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item"><a role="button" data-bs-toggle="modal" data-bs-target="#todoModal" href="#" id="modalfortodoitems">
    <button type="button" class="btn btn-danger">Outstanding todo items</button>
</a>

<div class="modal fade" id="todoModal" aria-labelledby="todoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title m-0 text-dark" id="todoModalLabel">Outstanding todo items</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div> 
        <div class="modal-body">
            <ul class="list-group list-group-flush" id="todolist">
                <!-- Auto generated for page -->
            </ul>
        </div>
        </div>
    </div>
</div>

<script>

    document.body.appendChild(document.getElementById('todoModal'));
    var modalfortodoitems = document.getElementById('modalfortodoitems');
    var modalfortodoitemsparent = modalfortodoitems.parentNode;
    var todoItems = document.getElementsByClassName('admonition-todo');
    var todolist = document.getElementById('todolist')

    if(todoItems.length == 0 || !todoItems[0].hasAttribute('id')) {
        modalfortodoitemsparent.remove();
    } else  {
        for (var i = 0; i < todoItems.length; ++i) {
            var todoItem = document.createElement('li');
            var link = document.createElement('a');
            link.textContent = todoItems[i].getElementsByTagName('p')[1].innerHTML;
            link.href = '#' + todoItems[i].id;
            link.addEventListener('click', function() {
                // Use Bootstrap's modal method to hide the modal
                const todoModal = document.getElementById('todoModal');
                const modal = bootstrap.Modal.getInstance(todoModal);
                modal.hide();
            });
            todoItem.appendChild(link);
            todoItem.classList.add('list-group-item');
            todolist.appendChild(todoItem);
        }
    }
    
</script></div>

  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-a-method-to-connect-your-sensor">Choosing a Method to Connect Your Sensor</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#input-and-run-a-python-or-javascript-application-for-talking-to-sensors">Input and Run a Python or JavaScript Application for Talking to Sensors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-status-of-a-pushbutton-or-magnetic-switch-passive-on-off-sensor">Reading the Status of a Pushbutton or Magnetic Switch (Passive On/Off Sensor)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapping-header-numbers-to-gpio-numbers">Mapping Header Numbers to gpio Numbers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-a-position-light-or-force-sensor-variable-resistance-sensor">Reading a Position, Light, or Force Sensor (Variable Resistance Sensor)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Solution</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-variable-resistor-with-three-terminals">A variable resistor with three terminals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-variable-resistor-with-two-terminals">A variable resistor with two terminals</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-a-distance-sensor-analog-or-variable-voltage-sensor">Reading a Distance Sensor (Analog or Variable Voltage Sensor)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-a-distance-sensor-variable-pulse-width-sensor">Reading a Distance Sensor (Variable Pulse Width Sensor)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accurately-reading-the-position-of-a-motor-or-dial">Accurately Reading the Position of a Motor or Dial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Solution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#acquiring-data-by-using-a-smart-sensor-over-a-serial-connection">Acquiring Data by Using a Smart Sensor over a Serial Connection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-a-temperature">Measuring a Temperature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i2c-tools">I<sup>2</sup>C tools</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-the-temperature-via-the-kernel-driver">Reading the temperature via the kernel driver</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-i2c-device-directly">Reading i2c device directly</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-temperature-via-a-dallas-1-wire-device">Reading Temperature via a Dallas 1-Wire Device</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#playing-and-recording-audio">Playing and Recording Audio</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#listing-the-alsa-audio-output-and-input-devices-on-the-bone">Listing the ALSA audio output and input devices on the Bone</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://openbeagle.org/docs/docs.beagleboard.io/-/edit/main/books/beaglebone-cookbook/02sensors/sensors.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on OpenBeagle
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/books/beaglebone-cookbook/02sensors/sensors.rst">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
    

    

    

    

    

    

    

    

    

    

    

    
        
        <a role="button" href="/beaglebone-cookbook.pdf" target="_blank">
            <i class="fa-solid fa-download"></i> Download PDF
        </a>
    

    

    

    
</div>

  <div class="sidebar-secondary-item"><a role="button" data-bs-toggle="modal" data-bs-target="#feedbackModal" href="#" onclick="getFeedbackButtonhref(this)">
    <i class="fa-regular fa-message"></i> Provide Feedback
</a>

<div class="modal fade" id="feedbackModal" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title m-0 text-dark" id="feedbackModalLabel">Feedback</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="btn-group mb-3" role="group" aria-label="Basic radio toggle button group" id="feedbackType"
                    onChange="feedbackHandler()">
                    <input type="radio" class="btn-check" name="feedbackType" id="btnradio1" autocomplete="off"
                        value="Issue">
                    <label class="btn btn-outline-dark shadow-none" for="btnradio1"><i
                            class="fa-solid fa-triangle-exclamation"></i> Issue</label>

                    <input type="radio" class="btn-check" name="feedbackType" id="btnradio2" autocomplete="off"
                        value="Feedback" checked>
                    <label class="btn btn-outline-dark shadow-none" for="btnradio2"><i
                            class="fa-regular fa-message"></i> Feedback</label>

                    <input type="radio" class="btn-check" name="feedbackType" id="btnradio3" autocomplete="off"
                        value="Idea">
                    <label class="btn btn-outline-dark shadow-none" for="btnradio3"><i
                            class="fa-solid fa-lightbulb"></i> Idea</label>
                </div>
                <div class="mb-3">
                    <input type="title" class="form-control bg-light text-dark" id="feedbackModalTitle"
                        placeholder="Title" onChange="feedbackHandler()">
                </div>
                <div class="mb-3">
                    <textarea class="form-control bg-light text-dark" id="feedbackModalDescription" minlength="13"
                        rows="3" placeholder="Description" onChange="feedbackHandler()"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="feedbackClear()">Clear
                    & Close</button>
                <span id="generateLinkButtonTooltip" data-bs-placement="bottom" data-bs-toggle="tooltip">
                    <a href="javascript:void(0);" id="feedbacklink" type="button"
                        class="btn btn-primary disabled text-light">
                        <i class="fa-solid fa-up-right-from-square"></i> Generate OpenBeagle Issue
                    </a>
                </span>
            </div>
        </div>
    </div>
</div>

<script>

    var titleMinLength = 4
    var descriptionMinLength = 12

    document.body.appendChild(document.getElementById('feedbackModal'));

    var generateLinkButtonTooltip = document.getElementById("generateLinkButtonTooltip")
    var link = document.getElementById("feedbacklink")
    var gitlab_project = ""
    var title = document.getElementById("feedbackModalTitle")
    var description = document.getElementById("feedbackModalDescription")
    var generatedFromLink = ""


    title.placeholder = "Title (minimum " + titleMinLength + " characters)"
    description.placeholder = "Description (minimum " + descriptionMinLength + " characters)"

    function feedbackHandler() {
        var type = document.querySelector('input[name="feedbackType"]:checked').value

        if (!gitlab_project.match(/^[a-zA-Z]+:\/\//)) {
            gitlab_project = 'https://' + gitlab_project;
        }

        if (title.value.length >= titleMinLength && description.value.length >= descriptionMinLength) {
            link.target = "_blank"
            link.classList.remove("disabled");
            generateLinkButtonTooltip.title = "You must be logged in to OpenBeagle.org to generate an Issue!"
            link.href = gitlab_project + "/-/issues/new?issue[title]=" + type + ": " + title.value + "&issue[description]=" + description.value + "%0A%0AGenerated from: " + generatedFromLink.replace('#', '%23')
        } else {
            link.classList.add("disabled");
            generateLinkButtonTooltip.title = "Add proper title and description to activate the link!"
        }
    }

    function feedbackClear() {
        title.value = ""
        description.value = ""
        link.href = ""
        link.classList.add("disabled");
    }

    document.addEventListener('DOMContentLoaded', function () {
        const headerlinks = document.getElementsByClassName("headerlink");

        for (let i = 0; i < headerlinks.length; i++) {
            if (headerlinks[i].classList.contains('headerlink-feedback')) {
                continue;
            }

            headerlinks[i].innerHTML = `<i class="fa-solid fa-link"></i>`;
            headerlinks[i].addEventListener('click', function (event) {
                event.preventDefault();
                const link = this.href;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(link).then(() => {
                        console.log("Link copied to clipboard:", link);
                        this.innerHTML = `<i class="fa-regular fa-square-check"></i>`;
                        setTimeout(() => {
                            this.innerHTML = `<i class="fa-solid fa-link"></i>`;
                        }, 1000);
                    }).catch(err => {
                        console.error("Failed to copy:", err);
                    });
                } else {
                    fallbackCopyText(link, this);
                }
            });

            const feedbackLink = headerlinks[i].cloneNode(true);

            feedbackLink.classList.add('headerlink-feedback');
            feedbackLink.innerHTML = '<i class="fa-regular fa-message"></i>';
            feedbackLink.title = "Provide Feedback";
            feedbackLink.setAttribute("data-bs-toggle", "modal");
            feedbackLink.setAttribute("data-bs-target", "#feedbackModal");
            feedbackLink.setAttribute("onclick", "getFeedbackButtonhref(this)");

            if (headerlinks[i].parentNode) {
                headerlinks[i].parentNode.insertBefore(feedbackLink, headerlinks[i].nextSibling || null);
            }
        }
    });

    function fallbackCopyText(text, element) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand("copy");
            element.innerHTML = `<i class="fa-regular fa-square-check"></i>`;
            setTimeout(() => {
                element.innerHTML = `<i class="fa-solid fa-link"></i>`;
            }, 1000);
        } catch (err) {
            console.error("Fallback: Failed to copy:", err);
        }
        document.body.removeChild(textarea);
    }

    function getFeedbackButtonhref(clickedFeedbackLink) {
        generatedFromLink = clickedFeedbackLink.href
        feedbackHandler()
    }

</script></div>

  <div class="sidebar-secondary-item"><a role="button" href="https://forum.beagleboard.org" target="_blank">
    <i class="fa-brands fa-discourse"></i> Discuss on Forum
</a></div>

  <div class="sidebar-secondary-item"><div class="card bg-light mt-4 text-center">
    <div class="card-body">
        <p class="card-text text-dark">
        <a href="https://www.beagleboard.org/" target="_blank">BeagleBoard.org</a> 
        is all about being open, please discuss in public on our 
        <a href="https://forum.beagleboard.org" target="_blank">forum</a>!</p>
    </div>
</div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        


      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, BeagleBoard.org Foundation.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__center">
      
        <div class="footer-item"><a href="https://creativecommons.org/licenses/by-sa/4.0/" style="text-decoration:none">
    <img src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg"/>
</a></div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="last-updated">
  Last updated on Jun 29, 2025.
  <br/>
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>